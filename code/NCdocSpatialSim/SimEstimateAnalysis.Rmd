---
title: "SimEstimateAnalysis"
author: "Andrew Walther"
date: "`r Sys.Date()`"
output: html_document
---

### Preliminaries (3x3)

```{r Load Libraries, message=FALSE, warning=FALSE}
# load packages
library(tidyverse)
library(ggplot2)
```

```{r}
### read in datasets ###
# 2x4 grid
beta_mse_results_TrtSpill_A02_B1_P08_R00 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtSpill_A02_B1_P08_R00.csv")
dim(beta_mse_results_TrtSpill_A02_B1_P08_R00)

mean(beta_mse_results_TrtSpill_A02_B1_P08_R00$bias)
mean(beta_mse_results_TrtSpill_A02_B1_P08_R00$variance)
mean(beta_mse_results_TrtSpill_A02_B1_P08_R00$MSE)

beta_mse_results_TrtSpill_A02_B1_P08_R001 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtSpill_A02_B1_P08_R001.csv")
dim(beta_mse_results_TrtSpill_A02_B1_P08_R001)

mean(beta_mse_results_TrtSpill_A02_B1_P08_R001$bias)
mean(beta_mse_results_TrtSpill_A02_B1_P08_R001$variance)
mean(beta_mse_results_TrtSpill_A02_B1_P08_R001$MSE)
```

```{r}
# 3x3 grid
beta_mse_results_TrtSpill_3x3_A02_B1_P08_R000 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtSpill_3x3_A02_B1_P08_R000.csv")
dim(beta_mse_results_TrtSpill_3x3_A02_B1_P08_R000)

mean(beta_mse_results_TrtSpill_3x3_A02_B1_P08_R000$bias)
mean(beta_mse_results_TrtSpill_3x3_A02_B1_P08_R000$variance)
mean(beta_mse_results_TrtSpill_3x3_A02_B1_P08_R000$MSE)

beta_mse_results_TrtSpill_3x3_A02_B1_P08_R001 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtSpill_3x3_A02_B1_P08_R001.csv")
dim(beta_mse_results_TrtSpill_3x3_A02_B1_P08_R001)

mean(beta_mse_results_TrtSpill_3x3_A02_B1_P08_R001$bias)
mean(beta_mse_results_TrtSpill_3x3_A02_B1_P08_R001$variance)
mean(beta_mse_results_TrtSpill_3x3_A02_B1_P08_R001$MSE)


# subset to block setting
beta_mse_results_TrtSpill_3x3_A02_B1_P08_R000_block <- beta_mse_results_TrtSpill_3x3_A02_B1_P08_R000
```

```{r}
# 3x4 grid
beta_mse_results_TrtSpill_3x4_A02_B1_P08_R000 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtSpill_3x4_A02_B1_P08_R000.csv")
dim(beta_mse_results_TrtSpill_3x4_A02_B1_P08_R000)

mean(beta_mse_results_TrtSpill_3x4_A02_B1_P08_R000$bias)
mean(beta_mse_results_TrtSpill_3x4_A02_B1_P08_R000$variance)
mean(beta_mse_results_TrtSpill_3x4_A02_B1_P08_R000$MSE)

beta_mse_results_TrtSpill_3x4_A02_B1_P08_R001 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtSpill_3x4_A02_B1_P08_R001.csv")
dim(beta_mse_results_TrtSpill_3x4_A02_B1_P08_R001)

mean(beta_mse_results_TrtSpill_3x4_A02_B1_P08_R001$bias)
mean(beta_mse_results_TrtSpill_3x4_A02_B1_P08_R001$variance)
mean(beta_mse_results_TrtSpill_3x4_A02_B1_P08_R001$MSE)
```

### Analysis of 2x4 plot

```{r}
### Load 2x4 datasets (random & block) ###
# TrtNoSpill
beta_mse_TrtNoSpill_2x4_A02_B1_P05_R00 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtNoSpill_2x4_A02_B1_P05_R00.csv")
beta_mse_TrtNoSpill_2x4_A02_B1_P05_R00_mean <- mean(beta_mse_TrtNoSpill_2x4_A02_B1_P05_R00$MSE) # random
beta_mse_TrtNoSpill_2x4_A02_B1_P05_R00_block_mean <- mean(beta_mse_TrtNoSpill_2x4_A02_B1_P05_R00$MSE[c(28, 43)]) # block

beta_mse_TrtNoSpill_2x4_A02_B1_P05_R001 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtNoSpill_2x4_A02_B1_P05_R001.csv")
beta_mse_TrtNoSpill_2x4_A02_B1_P05_R001_mean <- mean(beta_mse_TrtNoSpill_2x4_A02_B1_P05_R001$MSE) # random
beta_mse_TrtNoSpill_2x4_A02_B1_P05_R001_block_mean <- mean(beta_mse_TrtNoSpill_2x4_A02_B1_P05_R001$MSE[c(28, 43)]) # block

beta_mse_TrtNoSpill_2x4_A02_B1_P06_R00 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtNoSpill_2x4_A02_B1_P06_R00.csv")
beta_mse_TrtNoSpill_2x4_A02_B1_P06_R00_mean <- mean(beta_mse_TrtNoSpill_2x4_A02_B1_P06_R00$MSE) # random
beta_mse_TrtNoSpill_2x4_A02_B1_P06_R00_block_mean <- mean(beta_mse_TrtNoSpill_2x4_A02_B1_P06_R00$MSE[c(28, 43)]) # block

beta_mse_TrtNoSpill_2x4_A02_B1_P06_R001 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtNoSpill_2x4_A02_B1_P06_R001.csv")
beta_mse_TrtNoSpill_2x4_A02_B1_P06_R001_mean <- mean(beta_mse_TrtNoSpill_2x4_A02_B1_P06_R001$MSE) # random
beta_mse_TrtNoSpill_2x4_A02_B1_P06_R001_block_mean <- mean(beta_mse_TrtNoSpill_2x4_A02_B1_P06_R001$MSE[c(28, 43)]) # block

beta_mse_TrtNoSpill_2x4_A02_B1_P07_R00 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtNoSpill_2x4_A02_B1_P07_R00.csv")
beta_mse_TrtNoSpill_2x4_A02_B1_P07_R00_mean <- mean(beta_mse_TrtNoSpill_2x4_A02_B1_P07_R00$MSE) # random
beta_mse_TrtNoSpill_2x4_A02_B1_P07_R00_block_mean <- mean(beta_mse_TrtNoSpill_2x4_A02_B1_P07_R00$MSE[c(28, 43)]) # block

beta_mse_TrtNoSpill_2x4_A02_B1_P07_R001 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtNoSpill_2x4_A02_B1_P07_R001.csv")
beta_mse_TrtNoSpill_2x4_A02_B1_P07_R001_mean <- mean(beta_mse_TrtNoSpill_2x4_A02_B1_P07_R001$MSE) # random
beta_mse_TrtNoSpill_2x4_A02_B1_P07_R001_block_mean <- mean(beta_mse_TrtNoSpill_2x4_A02_B1_P07_R001$MSE[c(28, 43)]) # block

beta_mse_TrtNoSpill_2x4_A02_B1_P08_R00 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtNoSpill_2x4_A02_B1_P08_R00.csv")
beta_mse_TrtNoSpill_2x4_A02_B1_P08_R00_mean <- mean(beta_mse_TrtNoSpill_2x4_A02_B1_P08_R00$MSE) # random
beta_mse_TrtNoSpill_2x4_A02_B1_P08_R00_block_mean <- mean(beta_mse_TrtNoSpill_2x4_A02_B1_P08_R00$MSE[c(28, 43)]) # block

beta_mse_TrtNoSpill_2x4_A02_B1_P08_R001 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtNoSpill_2x4_A02_B1_P08_R001.csv")
beta_mse_TrtNoSpill_2x4_A02_B1_P08_R001_mean <- mean(beta_mse_TrtNoSpill_2x4_A02_B1_P08_R001$MSE) # random
beta_mse_TrtNoSpill_2x4_A02_B1_P08_R001_block_mean <- mean(beta_mse_TrtNoSpill_2x4_A02_B1_P08_R001$MSE[c(28, 43)]) # block

# TrtSpill
beta_mse_TrtSpill_2x4_A02_B1_P05_R00 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtSpill_2x4_A02_B1_P05_R00.csv")
beta_mse_TrtSpill_2x4_A02_B1_P05_R00_mean <- mean(beta_mse_TrtSpill_2x4_A02_B1_P05_R00$MSE) # random
beta_mse_TrtSpill_2x4_A02_B1_P05_R00_block_mean <- mean(beta_mse_TrtSpill_2x4_A02_B1_P05_R00$MSE[c(28, 43)]) # block

beta_mse_TrtSpill_2x4_A02_B1_P05_R001 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtSpill_2x4_A02_B1_P05_R001.csv")
beta_mse_TrtSpill_2x4_A02_B1_P05_R001_mean <- mean(beta_mse_TrtSpill_2x4_A02_B1_P05_R001$MSE) # random
beta_mse_TrtSpill_2x4_A02_B1_P05_R001_block_mean <- mean(beta_mse_TrtSpill_2x4_A02_B1_P05_R001$MSE[c(28, 43)]) # block

beta_mse_TrtSpill_2x4_A02_B1_P06_R00 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtSpill_2x4_A02_B1_P06_R00.csv")
beta_mse_TrtSpill_2x4_A02_B1_P06_R00_mean <- mean(beta_mse_TrtSpill_2x4_A02_B1_P06_R00$MSE) # random
beta_mse_TrtSpill_2x4_A02_B1_P06_R00_block_mean <- mean(beta_mse_TrtSpill_2x4_A02_B1_P06_R00$MSE[c(28, 43)]) # block

beta_mse_TrtSpill_2x4_A02_B1_P06_R001 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtSpill_2x4_A02_B1_P06_R001.csv")
beta_mse_TrtSpill_2x4_A02_B1_P06_R001_mean <- mean(beta_mse_TrtSpill_2x4_A02_B1_P06_R001$MSE) # random
beta_mse_TrtSpill_2x4_A02_B1_P06_R001_block_mean <- mean(beta_mse_TrtSpill_2x4_A02_B1_P06_R001$MSE[c(28, 43)]) # block

beta_mse_TrtSpill_2x4_A02_B1_P07_R00 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtSpill_2x4_A02_B1_P07_R00.csv")
beta_mse_TrtSpill_2x4_A02_B1_P07_R00_mean <- mean(beta_mse_TrtSpill_2x4_A02_B1_P07_R00$MSE) # random
beta_mse_TrtSpill_2x4_A02_B1_P07_R00_block_mean <- mean(beta_mse_TrtSpill_2x4_A02_B1_P07_R00$MSE[c(28, 43)]) # block

beta_mse_TrtSpill_2x4_A02_B1_P07_R001 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtSpill_2x4_A02_B1_P07_R001.csv")
beta_mse_TrtSpill_2x4_A02_B1_P07_R001_mean <- mean(beta_mse_TrtSpill_2x4_A02_B1_P07_R001$MSE) # random
beta_mse_TrtSpill_2x4_A02_B1_P07_R001_block_mean <- mean(beta_mse_TrtSpill_2x4_A02_B1_P07_R001$MSE[c(28, 43)]) # block

beta_mse_TrtSpill_2x4_A02_B1_P08_R00 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtSpill_2x4_A02_B1_P08_R00.csv")
beta_mse_TrtSpill_2x4_A02_B1_P08_R00_mean <- mean(beta_mse_TrtSpill_2x4_A02_B1_P08_R00$MSE) # random
beta_mse_TrtSpill_2x4_A02_B1_P08_R00_block_mean <- mean(beta_mse_TrtSpill_2x4_A02_B1_P08_R00$MSE[c(28, 43)]) # block

beta_mse_TrtSpill_2x4_A02_B1_P08_R001 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtSpill_2x4_A02_B1_P08_R001.csv")
beta_mse_TrtSpill_2x4_A02_B1_P08_R001_mean <- mean(beta_mse_TrtSpill_2x4_A02_B1_P08_R001$MSE) # random
beta_mse_TrtSpill_2x4_A02_B1_P08_R001_block_mean <- mean(beta_mse_TrtSpill_2x4_A02_B1_P08_R001$MSE[c(28, 43)]) # block
```

```{r}
### generate dataframe & plot (random) ###
# Create the data frame manually, row by row
df_random <- data.frame(
  TrtSpill = c(
    "No",  "No",  "No",  "No",
    "No",  "No",  "No",  "No",
    "Yes", "Yes", "Yes", "Yes",
    "Yes", "Yes", "Yes", "Yes"
  ),
  Rho = c(
    0.00, 0.001, 0.00, 0.001,
    0.00, 0.001, 0.00, 0.001,
    0.00, 0.001, 0.00, 0.001,
    0.00, 0.001, 0.00, 0.001
  ),
  Psi = c(
    0.5, 0.5, 0.6, 0.6,
    0.7, 0.7, 0.8, 0.8,
    0.5, 0.5, 0.6, 0.6,
    0.7, 0.7, 0.8, 0.8
  ),
  Estimate = c(
    beta_mse_TrtNoSpill_2x4_A02_B1_P05_R00_mean,
    beta_mse_TrtNoSpill_2x4_A02_B1_P05_R001_mean,
    beta_mse_TrtNoSpill_2x4_A02_B1_P06_R00_mean,
    beta_mse_TrtNoSpill_2x4_A02_B1_P06_R001_mean,
    beta_mse_TrtNoSpill_2x4_A02_B1_P07_R00_mean,
    beta_mse_TrtNoSpill_2x4_A02_B1_P07_R001_mean,
    beta_mse_TrtNoSpill_2x4_A02_B1_P08_R00_mean,
    beta_mse_TrtNoSpill_2x4_A02_B1_P08_R001_mean,
    beta_mse_TrtSpill_2x4_A02_B1_P05_R00_mean,
    beta_mse_TrtSpill_2x4_A02_B1_P05_R001_mean,
    beta_mse_TrtSpill_2x4_A02_B1_P06_R00_mean,
    beta_mse_TrtSpill_2x4_A02_B1_P06_R001_mean,
    beta_mse_TrtSpill_2x4_A02_B1_P07_R00_mean,
    beta_mse_TrtSpill_2x4_A02_B1_P07_R001_mean,
    beta_mse_TrtSpill_2x4_A02_B1_P08_R00_mean,
    beta_mse_TrtSpill_2x4_A02_B1_P08_R001_mean
  )
)
print(df_random)

# Ensure TrtSpill is a factor with desired order
df_random$TrtSpill <- factor(df_random$TrtSpill, levels = c("No", "Yes"))

# Create a combined grouping variable
df_random <- df_random %>%
  mutate(Condition = paste0("TrtSpill: ", TrtSpill, "\nRho: ", Rho))

# Optional: sort the Condition factor levels explicitly
df_random$Condition <- factor(df_random$Condition,
                       levels = c("TrtSpill: No\nRho: 0", 
                                  "TrtSpill: No\nRho: 0.001", 
                                  "TrtSpill: Yes\nRho: 0", 
                                  "TrtSpill: Yes\nRho: 0.001"))

# Plot of MSE estimates
ggplot(df_random, aes(x = Condition, y = Estimate)) +
  geom_point(aes(color = factor(Psi)), size = 3) +
  labs(
    title = "Beta MSE Estimates (2x4 all): stratified by TrtSpill, Psi, and Rho",
    x = "Condition",
    y = "MSE",
    color = "Psi"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 30, hjust = 1),
    plot.title = element_text(hjust = 0.5)
  )
```

```{r}
### generate dataframe & plot (block) ###
# Create the data frame manually, row by row
df_block <- data.frame(
  TrtSpill = c(
    "No",  "No",  "No",  "No",
    "No",  "No",  "No",  "No",
    "Yes", "Yes", "Yes", "Yes",
    "Yes", "Yes", "Yes", "Yes"
  ),
  Rho = c(
    0.00, 0.001, 0.00, 0.001,
    0.00, 0.001, 0.00, 0.001,
    0.00, 0.001, 0.00, 0.001,
    0.00, 0.001, 0.00, 0.001
  ),
  Psi = c(
    0.5, 0.5, 0.6, 0.6,
    0.7, 0.7, 0.8, 0.8,
    0.5, 0.5, 0.6, 0.6,
    0.7, 0.7, 0.8, 0.8
  ),
  Estimate = c(
    beta_mse_TrtNoSpill_2x4_A02_B1_P05_R00_block_mean,
    beta_mse_TrtNoSpill_2x4_A02_B1_P05_R001_block_mean,
    beta_mse_TrtNoSpill_2x4_A02_B1_P06_R00_block_mean,
    beta_mse_TrtNoSpill_2x4_A02_B1_P06_R001_block_mean,
    beta_mse_TrtNoSpill_2x4_A02_B1_P07_R00_block_mean,
    beta_mse_TrtNoSpill_2x4_A02_B1_P07_R001_block_mean,
    beta_mse_TrtNoSpill_2x4_A02_B1_P08_R00_block_mean,
    beta_mse_TrtNoSpill_2x4_A02_B1_P08_R001_block_mean,
    beta_mse_TrtSpill_2x4_A02_B1_P05_R00_block_mean,
    beta_mse_TrtSpill_2x4_A02_B1_P05_R001_block_mean,
    beta_mse_TrtSpill_2x4_A02_B1_P06_R00_block_mean,
    beta_mse_TrtSpill_2x4_A02_B1_P06_R001_block_mean,
    beta_mse_TrtSpill_2x4_A02_B1_P07_R00_block_mean,
    beta_mse_TrtSpill_2x4_A02_B1_P07_R001_block_mean,
    beta_mse_TrtSpill_2x4_A02_B1_P08_R00_block_mean,
    beta_mse_TrtSpill_2x4_A02_B1_P08_R001_block_mean
  )
)
print(df_block)

# Ensure TrtSpill is a factor with desired order
df_block$TrtSpill <- factor(df_block$TrtSpill, levels = c("No", "Yes"))

# Create a combined grouping variable
df_block <- df_block %>%
  mutate(Condition = paste0("TrtSpill: ", TrtSpill, "\nRho: ", Rho))

# Optional: sort the Condition factor levels explicitly
df_block$Condition <- factor(df_block$Condition,
                       levels = c("TrtSpill: No\nRho: 0", 
                                  "TrtSpill: No\nRho: 0.001", 
                                  "TrtSpill: Yes\nRho: 0", 
                                  "TrtSpill: Yes\nRho: 0.001"))

# Plot of MSE estimates
ggplot(df_block, aes(x = Condition, y = Estimate)) +
  geom_point(aes(color = factor(Psi)), size = 3) +
  labs(
    title = "Beta MSE Estimates (2x4 block): stratified by TrtSpill, Psi, and Rho",
    x = "Condition",
    y = "MSE",
    color = "Psi"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 30, hjust = 1),
    plot.title = element_text(hjust = 0.5)
  )
```

