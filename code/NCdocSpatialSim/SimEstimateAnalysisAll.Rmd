---
title: "SimEstimateAnalysisAll"
author: "Andrew Walther"
date: "`r Sys.Date()`"
output: html_document
---

### Preliminaries

- This R Markdown script plots two types of plots for each grouping of Psi, Rho, and Block vs. random sampling for each of the 2x4, 3x3, and 3x4 grid setups. Separate plots are made for each of the TrtSpill (yes/no) settings.
- One plot that is made is a box plot that contains the distribution of all estimates and the other plots the mean of a group of estimates with error bars for a corresponding 95% confidence interval.
- For each spatial grid setup, one plot is made for the "Block stratification" sampling setting and another for the "random" sampling setting such that there are 2 plots for each grid size. 
- The y-axis of each plot is the Mean Beta MSE for a particular grouping. 
- The x-axis lists the 4 combinations of Sampling setting (block/random) and Rho (0.00/0.01) and then then the plotted points are stratified by the 4 levels of the spillover parameter psi (0.5/0.6/0.7/0.8). 

```{r Load Libraries, message=FALSE, warning=FALSE}
# load packages
library(tidyverse)
library(ggplot2)
library(plotrix)
library(patchwork)
library(gridExtra)
```

### Function to process dfs

- add columns for: psi, rho, TrtSpill

```{r}
# function
# process_beta_mse <- function(df, psi_value, rho_value, trt_spill, block_indices = c(28, 43)) {
#   # Add specified values
#   df$Psi <- psi_value
#   df$Rho <- rho_value
#   df$TrtSpill <- trt_spill
#   df$Sampling <- "Random"
#   
#   # Create "random" version with selected columns removed
#   df_random <- df %>% dplyr::select(-c(X, bias, bias.abs))
#   
#   # Create "block" version with selected rows and update Sampling
#   df_block <- df_random[block_indices, ]
#   df_block$Sampling <- "Block"
#   
#   # Return both versions as a list
#   return(list(random = df_random, block = df_block))
# }
```

### Analysis of 2x4 plot (70)

```{r}
### Load 2x4 datasets (random & block) ###
## TrtNoSpill ##
# psi = 0.5, rho = 0.00
beta_mse_TrtNoSpill_2x4_A02_B1_P05_R00 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtNoSpill_2x4_A02_B1_P05_R00.csv")
beta_mse_TrtNoSpill_2x4_A02_B1_P05_R00$Psi <- 0.5
beta_mse_TrtNoSpill_2x4_A02_B1_P05_R00$Rho <- 0.00
beta_mse_TrtNoSpill_2x4_A02_B1_P05_R00$TrtSpill <- "No"
beta_mse_TrtNoSpill_2x4_A02_B1_P05_R00$Sampling <- "Random"
beta_mse_TrtNoSpill_2x4_A02_B1_P05_R00_random <- beta_mse_TrtNoSpill_2x4_A02_B1_P05_R00 %>% select(-c(X, bias.abs))
beta_mse_TrtNoSpill_2x4_A02_B1_P05_R00_block <- beta_mse_TrtNoSpill_2x4_A02_B1_P05_R00_random[c(28,43),]
beta_mse_TrtNoSpill_2x4_A02_B1_P05_R00_block$Sampling <- "Block"

# psi = 0.5, rho = 0.01
beta_mse_TrtNoSpill_2x4_A02_B1_P05_R001 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtNoSpill_2x4_A02_B1_P05_R001.csv")
beta_mse_TrtNoSpill_2x4_A02_B1_P05_R001$Psi <- 0.5
beta_mse_TrtNoSpill_2x4_A02_B1_P05_R001$Rho <- 0.01
beta_mse_TrtNoSpill_2x4_A02_B1_P05_R001$TrtSpill <- "No"
beta_mse_TrtNoSpill_2x4_A02_B1_P05_R001$Sampling <- "Random"
beta_mse_TrtNoSpill_2x4_A02_B1_P05_R001_random <- beta_mse_TrtNoSpill_2x4_A02_B1_P05_R001 %>% select(-c(X, bias.abs))
beta_mse_TrtNoSpill_2x4_A02_B1_P05_R001_block <- beta_mse_TrtNoSpill_2x4_A02_B1_P05_R001_random[c(28,43),]
beta_mse_TrtNoSpill_2x4_A02_B1_P05_R001_block$Sampling <- "Block"

# psi = 0.6, rho = 0.00
beta_mse_TrtNoSpill_2x4_A02_B1_P06_R00 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtNoSpill_2x4_A02_B1_P06_R00.csv")
beta_mse_TrtNoSpill_2x4_A02_B1_P06_R00$Psi <- 0.6
beta_mse_TrtNoSpill_2x4_A02_B1_P06_R00$Rho <- 0.00
beta_mse_TrtNoSpill_2x4_A02_B1_P06_R00$TrtSpill <- "No"
beta_mse_TrtNoSpill_2x4_A02_B1_P06_R00$Sampling <- "Random"
beta_mse_TrtNoSpill_2x4_A02_B1_P06_R00_random <- beta_mse_TrtNoSpill_2x4_A02_B1_P06_R00 %>% select(-c(X, bias.abs))
beta_mse_TrtNoSpill_2x4_A02_B1_P06_R00_block <- beta_mse_TrtNoSpill_2x4_A02_B1_P06_R00_random[c(28,43),]
beta_mse_TrtNoSpill_2x4_A02_B1_P06_R00_block$Sampling <- "Block"

# psi = 0.6, rho = 0.01
beta_mse_TrtNoSpill_2x4_A02_B1_P06_R001 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtNoSpill_2x4_A02_B1_P06_R001.csv")
beta_mse_TrtNoSpill_2x4_A02_B1_P06_R001$Psi <- 0.6
beta_mse_TrtNoSpill_2x4_A02_B1_P06_R001$Rho <- 0.01
beta_mse_TrtNoSpill_2x4_A02_B1_P06_R001$TrtSpill <- "No"
beta_mse_TrtNoSpill_2x4_A02_B1_P06_R001$Sampling <- "Random"
beta_mse_TrtNoSpill_2x4_A02_B1_P06_R001_random <- beta_mse_TrtNoSpill_2x4_A02_B1_P06_R001 %>% select(-c(X, bias.abs))
beta_mse_TrtNoSpill_2x4_A02_B1_P06_R001_block <- beta_mse_TrtNoSpill_2x4_A02_B1_P06_R001_random[c(28,43),]
beta_mse_TrtNoSpill_2x4_A02_B1_P06_R001_block$Sampling <- "Block"

# psi = 0.7, rho = 0.00
beta_mse_TrtNoSpill_2x4_A02_B1_P07_R00 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtNoSpill_2x4_A02_B1_P07_R00.csv")
beta_mse_TrtNoSpill_2x4_A02_B1_P07_R00$Psi <- 0.7
beta_mse_TrtNoSpill_2x4_A02_B1_P07_R00$Rho <- 0.00
beta_mse_TrtNoSpill_2x4_A02_B1_P07_R00$TrtSpill <- "No"
beta_mse_TrtNoSpill_2x4_A02_B1_P07_R00$Sampling <- "Random"
beta_mse_TrtNoSpill_2x4_A02_B1_P07_R00_random <- beta_mse_TrtNoSpill_2x4_A02_B1_P07_R00 %>% select(-c(X, bias.abs))
beta_mse_TrtNoSpill_2x4_A02_B1_P07_R00_block <- beta_mse_TrtNoSpill_2x4_A02_B1_P07_R00_random[c(28,43),]
beta_mse_TrtNoSpill_2x4_A02_B1_P07_R00_block$Sampling <- "Block"

# psi = 0.7, rho = 0.01
beta_mse_TrtNoSpill_2x4_A02_B1_P07_R001 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtNoSpill_2x4_A02_B1_P07_R001.csv")
beta_mse_TrtNoSpill_2x4_A02_B1_P07_R001$Psi <- 0.7
beta_mse_TrtNoSpill_2x4_A02_B1_P07_R001$Rho <- 0.01
beta_mse_TrtNoSpill_2x4_A02_B1_P07_R001$TrtSpill <- "No"
beta_mse_TrtNoSpill_2x4_A02_B1_P07_R001$Sampling <- "Random"
beta_mse_TrtNoSpill_2x4_A02_B1_P07_R001_random <- beta_mse_TrtNoSpill_2x4_A02_B1_P07_R001 %>% select(-c(X, bias.abs))
beta_mse_TrtNoSpill_2x4_A02_B1_P07_R001_block <- beta_mse_TrtNoSpill_2x4_A02_B1_P07_R001_random[c(28,43),]
beta_mse_TrtNoSpill_2x4_A02_B1_P07_R001_block$Sampling <- "Block"

# psi = 0.8, rho = 0.00
beta_mse_TrtNoSpill_2x4_A02_B1_P08_R00 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtNoSpill_2x4_A02_B1_P08_R00.csv")
beta_mse_TrtNoSpill_2x4_A02_B1_P08_R00$Psi <- 0.8
beta_mse_TrtNoSpill_2x4_A02_B1_P08_R00$Rho <- 0.00
beta_mse_TrtNoSpill_2x4_A02_B1_P08_R00$TrtSpill <- "No"
beta_mse_TrtNoSpill_2x4_A02_B1_P08_R00$Sampling <- "Random"
beta_mse_TrtNoSpill_2x4_A02_B1_P08_R00_random <- beta_mse_TrtNoSpill_2x4_A02_B1_P08_R00 %>% select(-c(X, bias.abs))
beta_mse_TrtNoSpill_2x4_A02_B1_P08_R00_block <- beta_mse_TrtNoSpill_2x4_A02_B1_P08_R00_random[c(28,43),]
beta_mse_TrtNoSpill_2x4_A02_B1_P08_R00_block$Sampling <- "Block"

# psi = 0.8, rho = 0.01
beta_mse_TrtNoSpill_2x4_A02_B1_P08_R001 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtNoSpill_2x4_A02_B1_P08_R001.csv")
beta_mse_TrtNoSpill_2x4_A02_B1_P08_R001$Psi <- 0.8
beta_mse_TrtNoSpill_2x4_A02_B1_P08_R001$Rho <- 0.01
beta_mse_TrtNoSpill_2x4_A02_B1_P08_R001$TrtSpill <- "No"
beta_mse_TrtNoSpill_2x4_A02_B1_P08_R001$Sampling <- "Random"
beta_mse_TrtNoSpill_2x4_A02_B1_P08_R001_random <- beta_mse_TrtNoSpill_2x4_A02_B1_P08_R001 %>% select(-c(X, bias.abs))
beta_mse_TrtNoSpill_2x4_A02_B1_P08_R001_block <- beta_mse_TrtNoSpill_2x4_A02_B1_P08_R001_random[c(28,43),]
beta_mse_TrtNoSpill_2x4_A02_B1_P08_R001_block$Sampling <- "Block"

## TrtSpill ##
# psi = 0.5, rho = 0.00
beta_mse_TrtSpill_2x4_A02_B1_P05_R00 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtSpill_2x4_A02_B1_P05_R00.csv")
beta_mse_TrtSpill_2x4_A02_B1_P05_R00$Psi <- 0.5
beta_mse_TrtSpill_2x4_A02_B1_P05_R00$Rho <- 0.00
beta_mse_TrtSpill_2x4_A02_B1_P05_R00$TrtSpill <- "Yes"
beta_mse_TrtSpill_2x4_A02_B1_P05_R00$Sampling <- "Random"
beta_mse_TrtSpill_2x4_A02_B1_P05_R00_random <- beta_mse_TrtSpill_2x4_A02_B1_P05_R00 %>% select(-c(X, bias.abs))
beta_mse_TrtSpill_2x4_A02_B1_P05_R00_block <- beta_mse_TrtSpill_2x4_A02_B1_P05_R00_random[c(28,43),]
beta_mse_TrtSpill_2x4_A02_B1_P05_R00_block$Sampling <- "Block"

# psi = 0.5, rho = 0.01
beta_mse_TrtSpill_2x4_A02_B1_P05_R001 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtSpill_2x4_A02_B1_P05_R001.csv")
beta_mse_TrtSpill_2x4_A02_B1_P05_R001$Psi <- 0.5
beta_mse_TrtSpill_2x4_A02_B1_P05_R001$Rho <- 0.01
beta_mse_TrtSpill_2x4_A02_B1_P05_R001$TrtSpill <- "Yes"
beta_mse_TrtSpill_2x4_A02_B1_P05_R001$Sampling <- "Random"
beta_mse_TrtSpill_2x4_A02_B1_P05_R001_random <- beta_mse_TrtSpill_2x4_A02_B1_P05_R001 %>% select(-c(X, bias.abs))
beta_mse_TrtSpill_2x4_A02_B1_P05_R001_block <- beta_mse_TrtSpill_2x4_A02_B1_P05_R001_random[c(28,43),]
beta_mse_TrtSpill_2x4_A02_B1_P05_R001_block$Sampling <- "Block"

# psi = 0.6, rho = 0.00
beta_mse_TrtSpill_2x4_A02_B1_P06_R00 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtSpill_2x4_A02_B1_P06_R00.csv")
beta_mse_TrtSpill_2x4_A02_B1_P06_R00$Psi <- 0.6
beta_mse_TrtSpill_2x4_A02_B1_P06_R00$Rho <- 0.00
beta_mse_TrtSpill_2x4_A02_B1_P06_R00$TrtSpill <- "Yes"
beta_mse_TrtSpill_2x4_A02_B1_P06_R00$Sampling <- "Random"
beta_mse_TrtSpill_2x4_A02_B1_P06_R00_random <- beta_mse_TrtSpill_2x4_A02_B1_P06_R00 %>% select(-c(X, bias.abs))
beta_mse_TrtSpill_2x4_A02_B1_P06_R00_block <- beta_mse_TrtSpill_2x4_A02_B1_P06_R00_random[c(28,43),]
beta_mse_TrtSpill_2x4_A02_B1_P06_R00_block$Sampling <- "Block"

# psi = 0.6, rho = 0.01
beta_mse_TrtSpill_2x4_A02_B1_P06_R001 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtSpill_2x4_A02_B1_P06_R001.csv")
beta_mse_TrtSpill_2x4_A02_B1_P06_R001$Psi <- 0.6
beta_mse_TrtSpill_2x4_A02_B1_P06_R001$Rho <- 0.01
beta_mse_TrtSpill_2x4_A02_B1_P06_R001$TrtSpill <- "Yes"
beta_mse_TrtSpill_2x4_A02_B1_P06_R001$Sampling <- "Random"
beta_mse_TrtSpill_2x4_A02_B1_P06_R001_random <- beta_mse_TrtSpill_2x4_A02_B1_P06_R001 %>% select(-c(X, bias.abs))
beta_mse_TrtSpill_2x4_A02_B1_P06_R001_block <- beta_mse_TrtSpill_2x4_A02_B1_P06_R001_random[c(28,43),]
beta_mse_TrtSpill_2x4_A02_B1_P06_R001_block$Sampling <- "Block"

# psi = 0.7, rho = 0.00
beta_mse_TrtSpill_2x4_A02_B1_P07_R00 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtSpill_2x4_A02_B1_P07_R00.csv")
beta_mse_TrtSpill_2x4_A02_B1_P07_R00$Psi <- 0.7
beta_mse_TrtSpill_2x4_A02_B1_P07_R00$Rho <- 0.00
beta_mse_TrtSpill_2x4_A02_B1_P07_R00$TrtSpill <- "Yes"
beta_mse_TrtSpill_2x4_A02_B1_P07_R00$Sampling <- "Random"
beta_mse_TrtSpill_2x4_A02_B1_P07_R00_random <- beta_mse_TrtSpill_2x4_A02_B1_P07_R00 %>% select(-c(X, bias.abs))
beta_mse_TrtSpill_2x4_A02_B1_P07_R00_block <- beta_mse_TrtSpill_2x4_A02_B1_P07_R00_random[c(28,43),]
beta_mse_TrtSpill_2x4_A02_B1_P07_R00_block$Sampling <- "Block"

# psi = 0.7, rho = 0.01
beta_mse_TrtSpill_2x4_A02_B1_P07_R001 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtSpill_2x4_A02_B1_P07_R001.csv")
beta_mse_TrtSpill_2x4_A02_B1_P07_R001$Psi <- 0.7
beta_mse_TrtSpill_2x4_A02_B1_P07_R001$Rho <- 0.01
beta_mse_TrtSpill_2x4_A02_B1_P07_R001$TrtSpill <- "Yes"
beta_mse_TrtSpill_2x4_A02_B1_P07_R001$Sampling <- "Random"
beta_mse_TrtSpill_2x4_A02_B1_P07_R001_random <- beta_mse_TrtSpill_2x4_A02_B1_P07_R001 %>% select(-c(X, bias.abs))
beta_mse_TrtSpill_2x4_A02_B1_P07_R001_block <- beta_mse_TrtSpill_2x4_A02_B1_P07_R001_random[c(28,43),]
beta_mse_TrtSpill_2x4_A02_B1_P07_R001_block$Sampling <- "Block"

# psi = 0.8, rho = 0.00
beta_mse_TrtSpill_2x4_A02_B1_P08_R00 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtSpill_2x4_A02_B1_P08_R00.csv")
beta_mse_TrtSpill_2x4_A02_B1_P08_R00$Psi <- 0.8
beta_mse_TrtSpill_2x4_A02_B1_P08_R00$Rho <- 0.00
beta_mse_TrtSpill_2x4_A02_B1_P08_R00$TrtSpill <- "Yes"
beta_mse_TrtSpill_2x4_A02_B1_P08_R00$Sampling <- "Random"
beta_mse_TrtSpill_2x4_A02_B1_P08_R00_random <- beta_mse_TrtSpill_2x4_A02_B1_P08_R00 %>% select(-c(X, bias.abs))
beta_mse_TrtSpill_2x4_A02_B1_P08_R00_block <- beta_mse_TrtSpill_2x4_A02_B1_P08_R00_random[c(28,43),]
beta_mse_TrtSpill_2x4_A02_B1_P08_R00_block$Sampling <- "Block"

# psi = 0.8, rho = 0.01
beta_mse_TrtSpill_2x4_A02_B1_P08_R001 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtSpill_2x4_A02_B1_P08_R001.csv")
beta_mse_TrtSpill_2x4_A02_B1_P08_R001$Psi <- 0.8
beta_mse_TrtSpill_2x4_A02_B1_P08_R001$Rho <- 0.01
beta_mse_TrtSpill_2x4_A02_B1_P08_R001$TrtSpill <- "Yes"
beta_mse_TrtSpill_2x4_A02_B1_P08_R001$Sampling <- "Random"
beta_mse_TrtSpill_2x4_A02_B1_P08_R001_random <- beta_mse_TrtSpill_2x4_A02_B1_P08_R001 %>% select(-c(X, bias.abs))
beta_mse_TrtSpill_2x4_A02_B1_P08_R001_block <- beta_mse_TrtSpill_2x4_A02_B1_P08_R001_random[c(28,43),]
beta_mse_TrtSpill_2x4_A02_B1_P08_R001_block$Sampling <- "Block"
```

```{r}
# --- Simplify Block Above ---
# # Load necessary libraries
# library(dplyr)
# library(purrr)
# library(stringr)
# 
# # Define a function to read and process one simulation file
# process_sim_file <- function(file_path) {
#   # Get just the filename to extract parameters from it
#   filename <- basename(file_path)
# 
#   # Extract parameters directly from the filename string
#   trt_spill <- if_else(str_detect(filename, "TrtNoSpill"), "No", "Yes")
#   psi <- as.numeric(str_sub(str_extract(filename, "P\\d{2}"), 2)) / 10
#   rho_str <- str_extract(filename, "R\\d{3}|R\\d{2}")
#   rho <- if_else(rho_str == "R00", 0.00, 0.01)
# 
#   # Read the CSV file and process the "Random" sampling data
#   data_random <- read.csv(file_path) %>%
#     select(-X, -bias.abs) %>%
#     mutate(Sampling = "Random")
# 
#   # Create the "Block" sampling data by subsetting specific rows
#   data_block <- data_random[c(28, 43), ] %>%
#     mutate(Sampling = "Block")
# 
#   # Combine "Random" and "Block" data, then add the parameter columns
#   bind_rows(data_random, data_block) %>%
#     mutate(
#       Psi = psi,
#       Rho = rho,
#       TrtSpill = trt_spill
#     )
# }
# 
# # 1. Define the base path to your data folder
# base_path <- "~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/"
# 
# # 2. Automatically find all relevant .csv files in the folder
# all_file_paths <- list.files(
#   path = base_path,
#   pattern = "beta_mse_results_.*_2x4_.*\\.csv$",
#   full.names = TRUE
# )
# 
# # 3. Apply the function to every file and stack them into one data frame
# all_data <- map_dfr(all_file_paths, process_sim_file)
```

```{r}
# Bind dfs for plotting
## TrtNoSpill ##
beta_mse_TrtNoSpill_join <- bind_rows(
  beta_mse_TrtNoSpill_2x4_A02_B1_P05_R00_random, # psi = 0.5, rho = 0.00
  beta_mse_TrtNoSpill_2x4_A02_B1_P05_R00_block, # psi = 0.5, rho = 0.00
  beta_mse_TrtNoSpill_2x4_A02_B1_P05_R001_random, # psi = 0.5, rho = 0.01
  beta_mse_TrtNoSpill_2x4_A02_B1_P05_R001_block, # psi = 0.5, rho = 0.01
  beta_mse_TrtNoSpill_2x4_A02_B1_P06_R00_random, # psi = 0.6, rho = 0.00
  beta_mse_TrtNoSpill_2x4_A02_B1_P06_R00_block, # psi = 0.6, rho = 0.00
  beta_mse_TrtNoSpill_2x4_A02_B1_P06_R001_random, # psi = 0.6, rho = 0.01
  beta_mse_TrtNoSpill_2x4_A02_B1_P06_R001_block, # psi = 0.6, rho = 0.01
  beta_mse_TrtNoSpill_2x4_A02_B1_P07_R00_random, # psi = 0.7, rho = 0.00
  beta_mse_TrtNoSpill_2x4_A02_B1_P07_R00_block, # psi = 0.7, rho = 0.00
  beta_mse_TrtNoSpill_2x4_A02_B1_P07_R001_random, # psi = 0.7, rho = 0.01
  beta_mse_TrtNoSpill_2x4_A02_B1_P07_R001_block, # psi = 0.7, rho = 0.01
  beta_mse_TrtNoSpill_2x4_A02_B1_P08_R00_random, # psi = 0.8, rho = 0.00
  beta_mse_TrtNoSpill_2x4_A02_B1_P08_R00_block, # psi = 0.8, rho = 0.00
  beta_mse_TrtNoSpill_2x4_A02_B1_P08_R001_random, # psi = 0.8, rho = 0.01
  beta_mse_TrtNoSpill_2x4_A02_B1_P08_R001_block, # psi = 0.8, rho = 0.01
)

## TrtSpill ##
beta_mse_TrtSpill_join <- bind_rows(
  beta_mse_TrtSpill_2x4_A02_B1_P05_R00_random, # psi = 0.5, rho = 0.00
  beta_mse_TrtSpill_2x4_A02_B1_P05_R00_block, # psi = 0.5, rho = 0.00
  beta_mse_TrtSpill_2x4_A02_B1_P05_R001_random, # psi = 0.5, rho = 0.01
  beta_mse_TrtSpill_2x4_A02_B1_P05_R001_block, # psi = 0.5, rho = 0.01
  beta_mse_TrtSpill_2x4_A02_B1_P06_R00_random, # psi = 0.6, rho = 0.00
  beta_mse_TrtSpill_2x4_A02_B1_P06_R00_block, # psi = 0.6, rho = 0.00
  beta_mse_TrtSpill_2x4_A02_B1_P06_R001_random, # psi = 0.6, rho = 0.01
  beta_mse_TrtSpill_2x4_A02_B1_P06_R001_block, # psi = 0.6, rho = 0.01
  beta_mse_TrtSpill_2x4_A02_B1_P07_R00_random, # psi = 0.7, rho = 0.00
  beta_mse_TrtSpill_2x4_A02_B1_P07_R00_block, # psi = 0.7, rho = 0.00
  beta_mse_TrtSpill_2x4_A02_B1_P07_R001_random, # psi = 0.7, rho = 0.01
  beta_mse_TrtSpill_2x4_A02_B1_P07_R001_block, # psi = 0.7, rho = 0.01
  beta_mse_TrtSpill_2x4_A02_B1_P08_R00_random, # psi = 0.8, rho = 0.00
  beta_mse_TrtSpill_2x4_A02_B1_P08_R00_block, # psi = 0.8, rho = 0.00
  beta_mse_TrtSpill_2x4_A02_B1_P08_R001_random, # psi = 0.8, rho = 0.01
  beta_mse_TrtSpill_2x4_A02_B1_P08_R001_block, # psi = 0.8, rho = 0.01
)
```

```{r}
### Boxplot for 2x4 TrtNoSpill ###
# Prepare the data
df_plot <- beta_mse_TrtNoSpill_join %>%
  mutate(
    Psi = as.factor(Psi),
    Rho = sprintf("%.2f", as.numeric(Rho)),
    Group = paste0("Rho=", Rho, ", ", Sampling)
  )
print(df_plot) # print estimates

# Plot with Psi as fill/group inside each Group
ggplot(df_plot, aes(x = Group, y = MSE, fill = Psi)) +
  geom_boxplot(outlier.alpha = 0.3, position = position_dodge(width = 0.75)) +
  theme_minimal(base_size = 14) +
  labs(
    title = "Beta MSE Estimates (2x4) by Psi, Rho, Sampling Group",
    x = "Condition (TrtNoSpill)",
    y = "Mean Squared Error (MSE)",
    fill = expression(Psi)
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
####################################################################################################
### Boxplot for 2x4 TrtSpill ###
# Prepare the data
df_plot <- beta_mse_TrtSpill_join %>%
  mutate(
    Psi = as.factor(Psi),
    Rho = sprintf("%.2f", as.numeric(Rho)),
    Group = paste0("Rho=", Rho, ", ", Sampling)
  )
print(df_plot) # print estimates

# Plot with Psi as fill/group inside each Group
ggplot(df_plot, aes(x = Group, y = MSE, fill = Psi)) +
  geom_boxplot(outlier.alpha = 0.3, position = position_dodge(width = 0.75)) +
  theme_minimal(base_size = 14) +
  labs(
    title = "Beta MSE Estimates (2x4) by Psi, Rho, Sampling Group",
    x = "Condition (TrtSpill)",
    y = "Mean Squared Error (MSE)",
    fill = expression(Psi)
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

```{r}
plot1 <- ggplot(beta_mse_TrtNoSpill_join, aes(x = Sampling, y = MSE, fill = as.factor(Psi))) +
  geom_boxplot(outlier.alpha = 0.3, position = position_dodge(width = 0.75)) +
  theme_minimal(base_size = 14) +
  labs(
    title = "Beta MSE Estimates (2x4) by Psi, Rho, Sampling Group",
    x = "Condition (TrtNoSpill)",
    y = "Mean Squared Error (MSE)",
    fill = expression(Psi)
  ) +
  facet_wrap(~ Rho, labeller = label_bquote(Rho == .(Rho)), scales = "free_y") + # remove scales = "free_y" to fix y-axis
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
print(plot1)

plot2 <- ggplot(beta_mse_TrtSpill_join, aes(x = Sampling, y = MSE, fill = as.factor(Psi))) +
  geom_boxplot(outlier.alpha = 0.3, position = position_dodge(width = 0.75)) +
  theme_minimal(base_size = 14) +
  labs(
    title = "Beta MSE Estimates (2x4) by Psi, Rho, Sampling Group",
    x = "Condition (TrtSpill)",
    y = "Mean Squared Error (MSE)",
    fill = expression(Psi)
  ) +
  facet_wrap(~ Rho, labeller = label_bquote(Rho == .(Rho)), scales = "free_y") + # remove scales = "free_y" to fix y-axis
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
print(plot2)

# stack plots
plot1 / plot2
```

```{r}
# --- Create 2x2 plot for 2x4 grid ---
# Combine the two data frames
combined_df <- bind_rows(beta_mse_TrtNoSpill_join, beta_mse_TrtSpill_join)

# Create a new data frame with the modified labels
combined_df_relabeled <- combined_df %>%
  mutate(TrtSpill = recode(TrtSpill,
                           "Yes" = "Intervention & Control",
                           "No" = "Control Only"))

# Generate the faceted plot from the combined data
ggplot(combined_df_relabeled, aes(x = Sampling, y = MSE, fill = as.factor(Psi))) +
  geom_boxplot(outlier.alpha = 0.3, position = position_dodge(width = 0.75)) +
  theme_minimal(base_size = 14) +
  labs(
    # title = "Beta MSE Estimates by Scenario",
    # subtitle = expression(paste("Faceted by Treatment Spillover Type and ", Rho)),
    x = "Sampling Group",
    y = "Mean Squared Error (MSE)",
    fill = expression(Psi)
  ) +
  # Use facet_grid to create a grid: rows ~ columns
  facet_grid(TrtSpill ~ Rho, scales = "free_y", labeller = label_bquote(rows = .(TrtSpill), cols = rho == .(Rho))) +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 10),
    strip.text.y = element_text(size = 8, angle = 90),
    axis.title.y = element_text(size = 10), # Adjusts the y-axis title size
    axis.title.x = element_text(size = 10), # Adjusts the x-axis title size
    # Add a border around each facet panel
    #panel.border = element_rect(color = "black", fill = NA, linewidth = 0.5)
  )
```

```{r}
### Point + 95% CI for 2x4 TrtNoSpill ###
# Step 1: Summarize the data
df_summary <- beta_mse_TrtNoSpill_join %>%
  mutate(
    Psi = as.factor(Psi),
    Rho = sprintf("%.2f", as.numeric(Rho)),
    Group = paste0("Rho=", Rho, ", ", Sampling)
  ) %>%
  group_by(Group, Psi) %>%
  summarise(
    mean_MSE = mean(MSE),
    sd_MSE = sd(MSE),
    se = sd(MSE) / sqrt(n()),
    mean_bias = mean(bias),
    .groups = "drop"
  ) %>%
  mutate(
    lower = mean_MSE - 1.96 * se,
    upper = mean_MSE + 1.96 * se
  )
print(df_summary) # print estimates

# Step 2: Plot
ggplot(df_summary, aes(x = Group, y = mean_MSE, color = Psi, group = Psi)) +
  geom_point(position = position_dodge(width = 0.5), size = 3) +
  geom_errorbar(aes(ymin = lower, ymax = upper),
                position = position_dodge(width = 0.5),
                width = 0.2) +
  theme_minimal(base_size = 14) +
  labs(
    title = "Beta MSE Estimates w/CI (2x4) by Psi, Rho, Sampling Group",
    x = "Condition (TrtNoSpill)",
    y = "Mean Squared Error (MSE)",
    color = expression(Psi)
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
####################################################################################################
### Point + 95% CI for 2x4 TrtSpill ###
# Step 1: Summarize the data
df_summary <- beta_mse_TrtSpill_join %>%
  mutate(
    Psi = as.factor(Psi),
    Rho = sprintf("%.2f", as.numeric(Rho)),
    Group = paste0("Rho=", Rho, ", ", Sampling)
  ) %>%
  group_by(Group, Psi) %>%
  summarise(
    mean_MSE = mean(MSE),
    sd_MSE = sd(MSE),
    se = sd(MSE) / sqrt(n()),
    mean_bias = mean(bias),
    .groups = "drop"
  ) %>%
  mutate(
    lower = mean_MSE - 1.96 * se,
    upper = mean_MSE + 1.96 * se
  )
print(df_summary) # print estimates

# Step 2: Plot
ggplot(df_summary, aes(x = Group, y = mean_MSE, color = Psi, group = Psi)) +
  geom_point(position = position_dodge(width = 0.5), size = 3) +
  geom_errorbar(aes(ymin = lower, ymax = upper),
                position = position_dodge(width = 0.5),
                width = 0.2) +
  theme_minimal(base_size = 14) +
  labs(
    title = "Beta MSE Estimates w/CI (2x4) by Psi, Rho, Sampling Group",
    x = "Condition (TrtSpill)",
    y = "Mean Squared Error (MSE)",
    color = expression(Psi)
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

### Analysis of 3x3 plot (X)

```{r}
### Load 3x3 datasets (random & block) ###
## TrtNoSpill ##
# psi = 0.5, rho = 0.00
beta_mse_TrtNoSpill_3x3_A02_B1_P05_R00 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtNoSpill_3x3_A02_B1_P05_R00.csv")
beta_mse_TrtNoSpill_3x3_A02_B1_P05_R00$Psi <- 0.5
beta_mse_TrtNoSpill_3x3_A02_B1_P05_R00$Rho <- 0.00
beta_mse_TrtNoSpill_3x3_A02_B1_P05_R00$TrtSpill <- "No"
beta_mse_TrtNoSpill_3x3_A02_B1_P05_R00$Sampling <- "Random"
beta_mse_TrtNoSpill_3x3_A02_B1_P05_R00_random <- beta_mse_TrtNoSpill_3x3_A02_B1_P05_R00 %>% select(-c(X, bias.abs))
beta_mse_TrtNoSpill_3x3_A02_B1_P05_R00_block <- beta_mse_TrtNoSpill_3x3_A02_B1_P05_R00_random[c(28,43),]
beta_mse_TrtNoSpill_3x3_A02_B1_P05_R00_block$Sampling <- "Block"

# psi = 0.5, rho = 0.01
beta_mse_TrtNoSpill_3x3_A02_B1_P05_R001 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtNoSpill_3x3_A02_B1_P05_R001.csv")
beta_mse_TrtNoSpill_3x3_A02_B1_P05_R001$Psi <- 0.5
beta_mse_TrtNoSpill_3x3_A02_B1_P05_R001$Rho <- 0.01
beta_mse_TrtNoSpill_3x3_A02_B1_P05_R001$TrtSpill <- "No"
beta_mse_TrtNoSpill_3x3_A02_B1_P05_R001$Sampling <- "Random"
beta_mse_TrtNoSpill_3x3_A02_B1_P05_R001_random <- beta_mse_TrtNoSpill_3x3_A02_B1_P05_R001 %>% select(-c(X, bias.abs))
beta_mse_TrtNoSpill_3x3_A02_B1_P05_R001_block <- beta_mse_TrtNoSpill_3x3_A02_B1_P05_R001_random[c(28,43),]
beta_mse_TrtNoSpill_3x3_A02_B1_P05_R001_block$Sampling <- "Block"

# psi = 0.6, rho = 0.00
beta_mse_TrtNoSpill_3x3_A02_B1_P06_R00 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtNoSpill_3x3_A02_B1_P06_R00.csv")
beta_mse_TrtNoSpill_3x3_A02_B1_P06_R00$Psi <- 0.6
beta_mse_TrtNoSpill_3x3_A02_B1_P06_R00$Rho <- 0.00
beta_mse_TrtNoSpill_3x3_A02_B1_P06_R00$TrtSpill <- "No"
beta_mse_TrtNoSpill_3x3_A02_B1_P06_R00$Sampling <- "Random"
beta_mse_TrtNoSpill_3x3_A02_B1_P06_R00_random <- beta_mse_TrtNoSpill_3x3_A02_B1_P06_R00 %>% select(-c(X, bias.abs))
beta_mse_TrtNoSpill_3x3_A02_B1_P06_R00_block <- beta_mse_TrtNoSpill_3x3_A02_B1_P06_R00_random[c(28,43),]
beta_mse_TrtNoSpill_3x3_A02_B1_P06_R00_block$Sampling <- "Block"

# psi = 0.6, rho = 0.01
beta_mse_TrtNoSpill_3x3_A02_B1_P06_R001 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtNoSpill_3x3_A02_B1_P06_R001.csv")
beta_mse_TrtNoSpill_3x3_A02_B1_P06_R001$Psi <- 0.6
beta_mse_TrtNoSpill_3x3_A02_B1_P06_R001$Rho <- 0.01
beta_mse_TrtNoSpill_3x3_A02_B1_P06_R001$TrtSpill <- "No"
beta_mse_TrtNoSpill_3x3_A02_B1_P06_R001$Sampling <- "Random"
beta_mse_TrtNoSpill_3x3_A02_B1_P06_R001_random <- beta_mse_TrtNoSpill_3x3_A02_B1_P06_R001 %>% select(-c(X, bias.abs))
beta_mse_TrtNoSpill_3x3_A02_B1_P06_R001_block <- beta_mse_TrtNoSpill_3x3_A02_B1_P06_R001_random[c(28,43),]
beta_mse_TrtNoSpill_3x3_A02_B1_P06_R001_block$Sampling <- "Block"

# psi = 0.7, rho = 0.00
beta_mse_TrtNoSpill_3x3_A02_B1_P07_R00 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtNoSpill_3x3_A02_B1_P07_R00.csv")
beta_mse_TrtNoSpill_3x3_A02_B1_P07_R00$Psi <- 0.7
beta_mse_TrtNoSpill_3x3_A02_B1_P07_R00$Rho <- 0.00
beta_mse_TrtNoSpill_3x3_A02_B1_P07_R00$TrtSpill <- "No"
beta_mse_TrtNoSpill_3x3_A02_B1_P07_R00$Sampling <- "Random"
beta_mse_TrtNoSpill_3x3_A02_B1_P07_R00_random <- beta_mse_TrtNoSpill_3x3_A02_B1_P07_R00 %>% select(-c(X, bias.abs))
beta_mse_TrtNoSpill_3x3_A02_B1_P07_R00_block <- beta_mse_TrtNoSpill_3x3_A02_B1_P07_R00_random[c(28,43),]
beta_mse_TrtNoSpill_3x3_A02_B1_P07_R00_block$Sampling <- "Block"

# psi = 0.7, rho = 0.01
beta_mse_TrtNoSpill_3x3_A02_B1_P07_R001 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtNoSpill_3x3_A02_B1_P07_R001.csv")
beta_mse_TrtNoSpill_3x3_A02_B1_P07_R001$Psi <- 0.7
beta_mse_TrtNoSpill_3x3_A02_B1_P07_R001$Rho <- 0.01
beta_mse_TrtNoSpill_3x3_A02_B1_P07_R001$TrtSpill <- "No"
beta_mse_TrtNoSpill_3x3_A02_B1_P07_R001$Sampling <- "Random"
beta_mse_TrtNoSpill_3x3_A02_B1_P07_R001_random <- beta_mse_TrtNoSpill_3x3_A02_B1_P07_R001 %>% select(-c(X, bias.abs))
beta_mse_TrtNoSpill_3x3_A02_B1_P07_R001_block <- beta_mse_TrtNoSpill_3x3_A02_B1_P07_R001_random[c(28,43),]
beta_mse_TrtNoSpill_3x3_A02_B1_P07_R001_block$Sampling <- "Block"

# psi = 0.8, rho = 0.00
beta_mse_TrtNoSpill_3x3_A02_B1_P08_R00 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtNoSpill_3x3_A02_B1_P08_R00.csv")
beta_mse_TrtNoSpill_3x3_A02_B1_P08_R00$Psi <- 0.8
beta_mse_TrtNoSpill_3x3_A02_B1_P08_R00$Rho <- 0.00
beta_mse_TrtNoSpill_3x3_A02_B1_P08_R00$TrtSpill <- "No"
beta_mse_TrtNoSpill_3x3_A02_B1_P08_R00$Sampling <- "Random"
beta_mse_TrtNoSpill_3x3_A02_B1_P08_R00_random <- beta_mse_TrtNoSpill_3x3_A02_B1_P08_R00 %>% select(-c(X, bias.abs))
beta_mse_TrtNoSpill_3x3_A02_B1_P08_R00_block <- beta_mse_TrtNoSpill_3x3_A02_B1_P08_R00_random[c(28,43),]
beta_mse_TrtNoSpill_3x3_A02_B1_P08_R00_block$Sampling <- "Block"

# psi = 0.8, rho = 0.01
beta_mse_TrtNoSpill_3x3_A02_B1_P08_R001 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtNoSpill_3x3_A02_B1_P08_R001.csv")
beta_mse_TrtNoSpill_3x3_A02_B1_P08_R001$Psi <- 0.8
beta_mse_TrtNoSpill_3x3_A02_B1_P08_R001$Rho <- 0.01
beta_mse_TrtNoSpill_3x3_A02_B1_P08_R001$TrtSpill <- "No"
beta_mse_TrtNoSpill_3x3_A02_B1_P08_R001$Sampling <- "Random"
beta_mse_TrtNoSpill_3x3_A02_B1_P08_R001_random <- beta_mse_TrtNoSpill_3x3_A02_B1_P08_R001 %>% select(-c(X, bias.abs))
beta_mse_TrtNoSpill_3x3_A02_B1_P08_R001_block <- beta_mse_TrtNoSpill_3x3_A02_B1_P08_R001_random[c(28,43),]
beta_mse_TrtNoSpill_3x3_A02_B1_P08_R001_block$Sampling <- "Block"

## TrtSpill ##
# psi = 0.5, rho = 0.00
beta_mse_TrtSpill_3x3_A02_B1_P05_R00 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtSpill_3x3_A02_B1_P05_R00.csv")
beta_mse_TrtSpill_3x3_A02_B1_P05_R00$Psi <- 0.5
beta_mse_TrtSpill_3x3_A02_B1_P05_R00$Rho <- 0.00
beta_mse_TrtSpill_3x3_A02_B1_P05_R00$TrtSpill <- "Yes"
beta_mse_TrtSpill_3x3_A02_B1_P05_R00$Sampling <- "Random"
beta_mse_TrtSpill_3x3_A02_B1_P05_R00_random <- beta_mse_TrtSpill_3x3_A02_B1_P05_R00 %>% select(-c(X, bias.abs))
beta_mse_TrtSpill_3x3_A02_B1_P05_R00_block <- beta_mse_TrtSpill_3x3_A02_B1_P05_R00_random[c(28,43),]
beta_mse_TrtSpill_3x3_A02_B1_P05_R00_block$Sampling <- "Block"

# psi = 0.5, rho = 0.01
beta_mse_TrtSpill_3x3_A02_B1_P05_R001 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtSpill_3x3_A02_B1_P05_R001.csv")
beta_mse_TrtSpill_3x3_A02_B1_P05_R001$Psi <- 0.5
beta_mse_TrtSpill_3x3_A02_B1_P05_R001$Rho <- 0.01
beta_mse_TrtSpill_3x3_A02_B1_P05_R001$TrtSpill <- "Yes"
beta_mse_TrtSpill_3x3_A02_B1_P05_R001$Sampling <- "Random"
beta_mse_TrtSpill_3x3_A02_B1_P05_R001_random <- beta_mse_TrtSpill_3x3_A02_B1_P05_R001 %>% select(-c(X, bias.abs))
beta_mse_TrtSpill_3x3_A02_B1_P05_R001_block <- beta_mse_TrtSpill_3x3_A02_B1_P05_R001_random[c(28,43),]
beta_mse_TrtSpill_3x3_A02_B1_P05_R001_block$Sampling <- "Block"

# psi = 0.6, rho = 0.00
beta_mse_TrtSpill_3x3_A02_B1_P06_R00 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtSpill_3x3_A02_B1_P06_R00.csv")
beta_mse_TrtSpill_3x3_A02_B1_P06_R00$Psi <- 0.6
beta_mse_TrtSpill_3x3_A02_B1_P06_R00$Rho <- 0.00
beta_mse_TrtSpill_3x3_A02_B1_P06_R00$TrtSpill <- "Yes"
beta_mse_TrtSpill_3x3_A02_B1_P06_R00$Sampling <- "Random"
beta_mse_TrtSpill_3x3_A02_B1_P06_R00_random <- beta_mse_TrtSpill_3x3_A02_B1_P06_R00 %>% select(-c(X, bias.abs))
beta_mse_TrtSpill_3x3_A02_B1_P06_R00_block <- beta_mse_TrtSpill_3x3_A02_B1_P06_R00_random[c(28,43),]
beta_mse_TrtSpill_3x3_A02_B1_P06_R00_block$Sampling <- "Block"

# psi = 0.6, rho = 0.01
beta_mse_TrtSpill_3x3_A02_B1_P06_R001 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtSpill_3x3_A02_B1_P06_R001.csv")
beta_mse_TrtSpill_3x3_A02_B1_P06_R001$Psi <- 0.6
beta_mse_TrtSpill_3x3_A02_B1_P06_R001$Rho <- 0.01
beta_mse_TrtSpill_3x3_A02_B1_P06_R001$TrtSpill <- "Yes"
beta_mse_TrtSpill_3x3_A02_B1_P06_R001$Sampling <- "Random"
beta_mse_TrtSpill_3x3_A02_B1_P06_R001_random <- beta_mse_TrtSpill_3x3_A02_B1_P06_R001 %>% select(-c(X, bias.abs))
beta_mse_TrtSpill_3x3_A02_B1_P06_R001_block <- beta_mse_TrtSpill_3x3_A02_B1_P06_R001_random[c(28,43),]
beta_mse_TrtSpill_3x3_A02_B1_P06_R001_block$Sampling <- "Block"

# psi = 0.7, rho = 0.00
beta_mse_TrtSpill_3x3_A02_B1_P07_R00 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtSpill_3x3_A02_B1_P07_R00.csv")
beta_mse_TrtSpill_3x3_A02_B1_P07_R00$Psi <- 0.7
beta_mse_TrtSpill_3x3_A02_B1_P07_R00$Rho <- 0.00
beta_mse_TrtSpill_3x3_A02_B1_P07_R00$TrtSpill <- "Yes"
beta_mse_TrtSpill_3x3_A02_B1_P07_R00$Sampling <- "Random"
beta_mse_TrtSpill_3x3_A02_B1_P07_R00_random <- beta_mse_TrtSpill_3x3_A02_B1_P07_R00 %>% select(-c(X, bias.abs))
beta_mse_TrtSpill_3x3_A02_B1_P07_R00_block <- beta_mse_TrtSpill_3x3_A02_B1_P07_R00_random[c(28,43),]
beta_mse_TrtSpill_3x3_A02_B1_P07_R00_block$Sampling <- "Block"

# psi = 0.7, rho = 0.01
beta_mse_TrtSpill_3x3_A02_B1_P07_R001 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtSpill_3x3_A02_B1_P07_R001.csv")
beta_mse_TrtSpill_3x3_A02_B1_P07_R001$Psi <- 0.7
beta_mse_TrtSpill_3x3_A02_B1_P07_R001$Rho <- 0.01
beta_mse_TrtSpill_3x3_A02_B1_P07_R001$TrtSpill <- "Yes"
beta_mse_TrtSpill_3x3_A02_B1_P07_R001$Sampling <- "Random"
beta_mse_TrtSpill_3x3_A02_B1_P07_R001_random <- beta_mse_TrtSpill_3x3_A02_B1_P07_R001 %>% select(-c(X, bias.abs))
beta_mse_TrtSpill_3x3_A02_B1_P07_R001_block <- beta_mse_TrtSpill_3x3_A02_B1_P07_R001_random[c(28,43),]
beta_mse_TrtSpill_3x3_A02_B1_P07_R001_block$Sampling <- "Block"

# psi = 0.8, rho = 0.00
beta_mse_TrtSpill_3x3_A02_B1_P08_R00 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtSpill_3x3_A02_B1_P08_R00.csv")
beta_mse_TrtSpill_3x3_A02_B1_P08_R00$Psi <- 0.8
beta_mse_TrtSpill_3x3_A02_B1_P08_R00$Rho <- 0.00
beta_mse_TrtSpill_3x3_A02_B1_P08_R00$TrtSpill <- "Yes"
beta_mse_TrtSpill_3x3_A02_B1_P08_R00$Sampling <- "Random"
beta_mse_TrtSpill_3x3_A02_B1_P08_R00_random <- beta_mse_TrtSpill_3x3_A02_B1_P08_R00 %>% select(-c(X, bias.abs))
beta_mse_TrtSpill_3x3_A02_B1_P08_R00_block <- beta_mse_TrtSpill_3x3_A02_B1_P08_R00_random[c(28,43),]
beta_mse_TrtSpill_3x3_A02_B1_P08_R00_block$Sampling <- "Block"

# psi = 0.8, rho = 0.01
beta_mse_TrtSpill_3x3_A02_B1_P08_R001 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtSpill_3x3_A02_B1_P08_R001.csv")
beta_mse_TrtSpill_3x3_A02_B1_P08_R001$Psi <- 0.8
beta_mse_TrtSpill_3x3_A02_B1_P08_R001$Rho <- 0.01
beta_mse_TrtSpill_3x3_A02_B1_P08_R001$TrtSpill <- "Yes"
beta_mse_TrtSpill_3x3_A02_B1_P08_R001$Sampling <- "Random"
beta_mse_TrtSpill_3x3_A02_B1_P08_R001_random <- beta_mse_TrtSpill_3x3_A02_B1_P08_R001 %>% select(-c(X, bias.abs))
beta_mse_TrtSpill_3x3_A02_B1_P08_R001_block <- beta_mse_TrtSpill_3x3_A02_B1_P08_R001_random[c(28,43),]
beta_mse_TrtSpill_3x3_A02_B1_P08_R001_block$Sampling <- "Block"
```

```{r}
# Bind dfs for plotting
## TrtNoSpill ##
beta_mse_TrtNoSpill_join <- bind_rows(
  beta_mse_TrtNoSpill_3x3_A02_B1_P05_R00_random, # psi = 0.5, rho = 0.00
  beta_mse_TrtNoSpill_3x3_A02_B1_P05_R00_block, # psi = 0.5, rho = 0.00
  beta_mse_TrtNoSpill_3x3_A02_B1_P05_R001_random, # psi = 0.5, rho = 0.01
  beta_mse_TrtNoSpill_3x3_A02_B1_P05_R001_block, # psi = 0.5, rho = 0.01
  beta_mse_TrtNoSpill_3x3_A02_B1_P06_R00_random, # psi = 0.6, rho = 0.00
  beta_mse_TrtNoSpill_3x3_A02_B1_P06_R00_block, # psi = 0.6, rho = 0.00
  beta_mse_TrtNoSpill_3x3_A02_B1_P06_R001_random, # psi = 0.6, rho = 0.01
  beta_mse_TrtNoSpill_3x3_A02_B1_P06_R001_block, # psi = 0.6, rho = 0.01
  beta_mse_TrtNoSpill_3x3_A02_B1_P07_R00_random, # psi = 0.7, rho = 0.00
  beta_mse_TrtNoSpill_3x3_A02_B1_P07_R00_block, # psi = 0.7, rho = 0.00
  beta_mse_TrtNoSpill_3x3_A02_B1_P07_R001_random, # psi = 0.7, rho = 0.01
  beta_mse_TrtNoSpill_3x3_A02_B1_P07_R001_block, # psi = 0.7, rho = 0.01
  beta_mse_TrtNoSpill_3x3_A02_B1_P08_R00_random, # psi = 0.8, rho = 0.00
  beta_mse_TrtNoSpill_3x3_A02_B1_P08_R00_block, # psi = 0.8, rho = 0.00
  beta_mse_TrtNoSpill_3x3_A02_B1_P08_R001_random, # psi = 0.8, rho = 0.01
  beta_mse_TrtNoSpill_3x3_A02_B1_P08_R001_block, # psi = 0.8, rho = 0.01
)

## TrtSpill ##
beta_mse_TrtSpill_join <- bind_rows(
  beta_mse_TrtSpill_3x3_A02_B1_P05_R00_random, # psi = 0.5, rho = 0.00
  beta_mse_TrtSpill_3x3_A02_B1_P05_R00_block, # psi = 0.5, rho = 0.00
  beta_mse_TrtSpill_3x3_A02_B1_P05_R001_random, # psi = 0.5, rho = 0.01
  beta_mse_TrtSpill_3x3_A02_B1_P05_R001_block, # psi = 0.5, rho = 0.01
  beta_mse_TrtSpill_3x3_A02_B1_P06_R00_random, # psi = 0.6, rho = 0.00
  beta_mse_TrtSpill_3x3_A02_B1_P06_R00_block, # psi = 0.6, rho = 0.00
  beta_mse_TrtSpill_3x3_A02_B1_P06_R001_random, # psi = 0.6, rho = 0.01
  beta_mse_TrtSpill_3x3_A02_B1_P06_R001_block, # psi = 0.6, rho = 0.01
  beta_mse_TrtSpill_3x3_A02_B1_P07_R00_random, # psi = 0.7, rho = 0.00
  beta_mse_TrtSpill_3x3_A02_B1_P07_R00_block, # psi = 0.7, rho = 0.00
  beta_mse_TrtSpill_3x3_A02_B1_P07_R001_random, # psi = 0.7, rho = 0.01
  beta_mse_TrtSpill_3x3_A02_B1_P07_R001_block, # psi = 0.7, rho = 0.01
  beta_mse_TrtSpill_3x3_A02_B1_P08_R00_random, # psi = 0.8, rho = 0.00
  beta_mse_TrtSpill_3x3_A02_B1_P08_R00_block, # psi = 0.8, rho = 0.00
  beta_mse_TrtSpill_3x3_A02_B1_P08_R001_random, # psi = 0.8, rho = 0.01
  beta_mse_TrtSpill_3x3_A02_B1_P08_R001_block, # psi = 0.8, rho = 0.01
)
```

```{r}
### Boxplot for 3x3 TrtNoSpill ###
# Prepare the data
df_plot <- beta_mse_TrtNoSpill_join %>%
  mutate(
    Psi = as.factor(Psi),
    Rho = sprintf("%.2f", as.numeric(Rho)),
    Group = paste0("Rho=", Rho, ", ", Sampling)
  )
print(df_plot) # print estimates

# Plot with Psi as fill/group inside each Group
ggplot(df_plot, aes(x = Group, y = MSE, fill = Psi)) +
  geom_boxplot(outlier.alpha = 0.3, position = position_dodge(width = 0.75)) +
  theme_minimal(base_size = 14) +
  labs(
    title = "Beta MSE Estimates (3x3) by Psi, Rho, Sampling Group",
    x = "Condition (TrtNoSpill)",
    y = "Mean Squared Error (MSE)",
    fill = expression(Psi)
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
####################################################################################################
### Boxplot for 3x3 TrtSpill ###
# Prepare the data
df_plot <- beta_mse_TrtSpill_join %>%
  mutate(
    Psi = as.factor(Psi),
    Rho = sprintf("%.2f", as.numeric(Rho)),
    Group = paste0("Rho=", Rho, ", ", Sampling)
  )
print(df_plot) # print estimates

# Plot with Psi as fill/group inside each Group
ggplot(df_plot, aes(x = Group, y = MSE, fill = Psi)) +
  geom_boxplot(outlier.alpha = 0.3, position = position_dodge(width = 0.75)) +
  theme_minimal(base_size = 14) +
  labs(
    title = "Beta MSE Estimates (3x3) by Psi, Rho, Sampling Group",
    x = "Condition (TrtSpill)",
    y = "Mean Squared Error (MSE)",
    fill = expression(Psi)
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

```{r}
plot1 <- ggplot(beta_mse_TrtNoSpill_join, aes(x = Sampling, y = MSE, fill = as.factor(Psi))) +
  geom_boxplot(outlier.alpha = 0.3, position = position_dodge(width = 0.75)) +
  theme_minimal(base_size = 14) +
  labs(
    title = "Beta MSE Estimates (3x3) by Psi, Rho, Sampling Group",
    x = "Condition (TrtNoSpill)",
    y = "Mean Squared Error (MSE)",
    fill = expression(Psi)
  ) +
  facet_wrap(~ Rho, labeller = label_bquote(Rho == .(Rho)), scales = "free_y") + # remove scales = "free_y" to fix y-axis
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
print(plot1)

plot2 <- ggplot(beta_mse_TrtSpill_join, aes(x = Sampling, y = MSE, fill = as.factor(Psi))) +
  geom_boxplot(outlier.alpha = 0.3, position = position_dodge(width = 0.75)) +
  theme_minimal(base_size = 14) +
  labs(
    title = "Beta MSE Estimates (3x3) by Psi, Rho, Sampling Group",
    x = "Condition (TrtSpill)",
    y = "Mean Squared Error (MSE)",
    fill = expression(Psi)
  ) +
  facet_wrap(~ Rho, labeller = label_bquote(Rho == .(Rho)), scales = "free_y") + # remove scales = "free_y" to fix y-axis
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
print(plot2)

# stack plots
plot1 / plot2
```
```{r}
# --- Create 2x2 plot for 3x3 grid ---
# Combine the two data frames
combined_df <- bind_rows(beta_mse_TrtNoSpill_join, beta_mse_TrtSpill_join)

# Create a new data frame with the modified labels
combined_df_relabeled <- combined_df %>%
  mutate(TrtSpill = recode(TrtSpill,
                           "Yes" = "Intervention & Control",
                           "No" = "Control Only"))

# Generate the faceted plot from the combined data
ggplot(combined_df_relabeled, aes(x = Sampling, y = MSE, fill = as.factor(Psi))) +
  geom_boxplot(outlier.alpha = 0.3, position = position_dodge(width = 0.75)) +
  theme_minimal(base_size = 14) +
  labs(
    # title = "Beta MSE Estimates by Scenario",
    # subtitle = expression(paste("Faceted by Treatment Spillover Type and ", Rho)),
    x = "Sampling Group",
    y = "Mean Squared Error (MSE)",
    fill = expression(Psi)
  ) +
  # Use facet_grid to create a grid: rows ~ columns
  facet_grid(TrtSpill ~ Rho, scales = "free_y", labeller = label_bquote(rows = .(TrtSpill), cols = rho == .(Rho))) +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 10),
    strip.text.y = element_text(size = 8, angle = 90),
    axis.title.y = element_text(size = 10), # Adjusts the y-axis title size
    axis.title.x = element_text(size = 10), # Adjusts the x-axis title size
    # Add a border around each facet panel
    #panel.border = element_rect(color = "black", fill = NA, linewidth = 0.5)
  )
```

```{r}
### Point + 95% CI for 3x3 TrtNoSpill ###
# Step 1: Summarize the data
df_summary <- beta_mse_TrtNoSpill_join %>%
  mutate(
    Psi = as.factor(Psi),
    Rho = sprintf("%.2f", as.numeric(Rho)),
    Group = paste0("Rho=", Rho, ", ", Sampling)
  ) %>%
  group_by(Group, Psi) %>%
  summarise(
    mean_MSE = mean(MSE),
    sd_MSE = sd(MSE),
    se = sd(MSE) / sqrt(n()),
    mean_bias = mean(bias),
    .groups = "drop"
  ) %>%
  mutate(
    lower = mean_MSE - 1.96 * se,
    upper = mean_MSE + 1.96 * se
  )
print(df_summary) # print estimates

# Step 2: Plot
ggplot(df_summary, aes(x = Group, y = mean_MSE, color = Psi, group = Psi)) +
  geom_point(position = position_dodge(width = 0.5), size = 3) +
  geom_errorbar(aes(ymin = lower, ymax = upper),
                position = position_dodge(width = 0.5),
                width = 0.2) +
  theme_minimal(base_size = 14) +
  labs(
    title = "Beta MSE Estimates w/CI (3x3) by Psi, Rho, Sampling Group",
    x = "Condition (TrtNoSpill)",
    y = "Mean Squared Error (MSE)",
    color = expression(Psi)
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
####################################################################################################
### Point + 95% CI for 3x3 TrtSpill ###
# Step 1: Summarize the data
df_summary <- beta_mse_TrtSpill_join %>%
  mutate(
    Psi = as.factor(Psi),
    Rho = sprintf("%.2f", as.numeric(Rho)),
    Group = paste0("Rho=", Rho, ", ", Sampling)
  ) %>%
  group_by(Group, Psi) %>%
  summarise(
    mean_MSE = mean(MSE),
    sd_MSE = sd(MSE),
    se = sd(MSE) / sqrt(n()),
    mean_bias = mean(bias),
    .groups = "drop"
  ) %>%
  mutate(
    lower = mean_MSE - 1.96 * se,
    upper = mean_MSE + 1.96 * se
  )
print(df_summary) # print estimates

# Step 2: Plot
ggplot(df_summary, aes(x = Group, y = mean_MSE, color = Psi, group = Psi)) +
  geom_point(position = position_dodge(width = 0.5), size = 3) +
  geom_errorbar(aes(ymin = lower, ymax = upper),
                position = position_dodge(width = 0.5),
                width = 0.2) +
  theme_minimal(base_size = 14) +
  labs(
    title = "Beta MSE Estimates w/CI (3x3) by Psi, Rho, Sampling Group",
    x = "Condition (TrtSpill)",
    y = "Mean Squared Error (MSE)",
    color = expression(Psi)
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

### Analysis of 3x4 plot (X)

```{r}
### Load 3x4 datasets (random & block) ###
## TrtNoSpill ##
# psi = 0.5, rho = 0.00
beta_mse_TrtNoSpill_3x4_A02_B1_P05_R00 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtNoSpill_3x4_A02_B1_P05_R00.csv")
beta_mse_TrtNoSpill_3x4_A02_B1_P05_R00$Psi <- 0.5
beta_mse_TrtNoSpill_3x4_A02_B1_P05_R00$Rho <- 0.00
beta_mse_TrtNoSpill_3x4_A02_B1_P05_R00$TrtSpill <- "No"
beta_mse_TrtNoSpill_3x4_A02_B1_P05_R00$Sampling <- "Random"
beta_mse_TrtNoSpill_3x4_A02_B1_P05_R00_random <- beta_mse_TrtNoSpill_3x4_A02_B1_P05_R00 %>% select(-c(X, bias.abs))
beta_mse_TrtNoSpill_3x4_A02_B1_P05_R00_block <- beta_mse_TrtNoSpill_3x4_A02_B1_P05_R00_random[c(28,43),]
beta_mse_TrtNoSpill_3x4_A02_B1_P05_R00_block$Sampling <- "Block"

# psi = 0.5, rho = 0.01
beta_mse_TrtNoSpill_3x4_A02_B1_P05_R001 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtNoSpill_3x4_A02_B1_P05_R001.csv")
beta_mse_TrtNoSpill_3x4_A02_B1_P05_R001$Psi <- 0.5
beta_mse_TrtNoSpill_3x4_A02_B1_P05_R001$Rho <- 0.01
beta_mse_TrtNoSpill_3x4_A02_B1_P05_R001$TrtSpill <- "No"
beta_mse_TrtNoSpill_3x4_A02_B1_P05_R001$Sampling <- "Random"
beta_mse_TrtNoSpill_3x4_A02_B1_P05_R001_random <- beta_mse_TrtNoSpill_3x4_A02_B1_P05_R001 %>% select(-c(X, bias.abs))
beta_mse_TrtNoSpill_3x4_A02_B1_P05_R001_block <- beta_mse_TrtNoSpill_3x4_A02_B1_P05_R001_random[c(28,43),]
beta_mse_TrtNoSpill_3x4_A02_B1_P05_R001_block$Sampling <- "Block"

# psi = 0.6, rho = 0.00
beta_mse_TrtNoSpill_3x4_A02_B1_P06_R00 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtNoSpill_3x4_A02_B1_P06_R00.csv")
beta_mse_TrtNoSpill_3x4_A02_B1_P06_R00$Psi <- 0.6
beta_mse_TrtNoSpill_3x4_A02_B1_P06_R00$Rho <- 0.00
beta_mse_TrtNoSpill_3x4_A02_B1_P06_R00$TrtSpill <- "No"
beta_mse_TrtNoSpill_3x4_A02_B1_P06_R00$Sampling <- "Random"
beta_mse_TrtNoSpill_3x4_A02_B1_P06_R00_random <- beta_mse_TrtNoSpill_3x4_A02_B1_P06_R00 %>% select(-c(X, bias.abs))
beta_mse_TrtNoSpill_3x4_A02_B1_P06_R00_block <- beta_mse_TrtNoSpill_3x4_A02_B1_P06_R00_random[c(28,43),]
beta_mse_TrtNoSpill_3x4_A02_B1_P06_R00_block$Sampling <- "Block"

# psi = 0.6, rho = 0.01
beta_mse_TrtNoSpill_3x4_A02_B1_P06_R001 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtNoSpill_3x4_A02_B1_P06_R001.csv")
beta_mse_TrtNoSpill_3x4_A02_B1_P06_R001$Psi <- 0.6
beta_mse_TrtNoSpill_3x4_A02_B1_P06_R001$Rho <- 0.01
beta_mse_TrtNoSpill_3x4_A02_B1_P06_R001$TrtSpill <- "No"
beta_mse_TrtNoSpill_3x4_A02_B1_P06_R001$Sampling <- "Random"
beta_mse_TrtNoSpill_3x4_A02_B1_P06_R001_random <- beta_mse_TrtNoSpill_3x4_A02_B1_P06_R001 %>% select(-c(X, bias.abs))
beta_mse_TrtNoSpill_3x4_A02_B1_P06_R001_block <- beta_mse_TrtNoSpill_3x4_A02_B1_P06_R001_random[c(28,43),]
beta_mse_TrtNoSpill_3x4_A02_B1_P06_R001_block$Sampling <- "Block"

# psi = 0.7, rho = 0.00
beta_mse_TrtNoSpill_3x4_A02_B1_P07_R00 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtNoSpill_3x4_A02_B1_P07_R00.csv")
beta_mse_TrtNoSpill_3x4_A02_B1_P07_R00$Psi <- 0.7
beta_mse_TrtNoSpill_3x4_A02_B1_P07_R00$Rho <- 0.00
beta_mse_TrtNoSpill_3x4_A02_B1_P07_R00$TrtSpill <- "No"
beta_mse_TrtNoSpill_3x4_A02_B1_P07_R00$Sampling <- "Random"
beta_mse_TrtNoSpill_3x4_A02_B1_P07_R00_random <- beta_mse_TrtNoSpill_3x4_A02_B1_P07_R00 %>% select(-c(X, bias.abs))
beta_mse_TrtNoSpill_3x4_A02_B1_P07_R00_block <- beta_mse_TrtNoSpill_3x4_A02_B1_P07_R00_random[c(28,43),]
beta_mse_TrtNoSpill_3x4_A02_B1_P07_R00_block$Sampling <- "Block"

# psi = 0.7, rho = 0.01
beta_mse_TrtNoSpill_3x4_A02_B1_P07_R001 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtNoSpill_3x4_A02_B1_P07_R001.csv")
beta_mse_TrtNoSpill_3x4_A02_B1_P07_R001$Psi <- 0.7
beta_mse_TrtNoSpill_3x4_A02_B1_P07_R001$Rho <- 0.01
beta_mse_TrtNoSpill_3x4_A02_B1_P07_R001$TrtSpill <- "No"
beta_mse_TrtNoSpill_3x4_A02_B1_P07_R001$Sampling <- "Random"
beta_mse_TrtNoSpill_3x4_A02_B1_P07_R001_random <- beta_mse_TrtNoSpill_3x4_A02_B1_P07_R001 %>% select(-c(X, bias.abs))
beta_mse_TrtNoSpill_3x4_A02_B1_P07_R001_block <- beta_mse_TrtNoSpill_3x4_A02_B1_P07_R001_random[c(28,43),]
beta_mse_TrtNoSpill_3x4_A02_B1_P07_R001_block$Sampling <- "Block"

# psi = 0.8, rho = 0.00
beta_mse_TrtNoSpill_3x4_A02_B1_P08_R00 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtNoSpill_3x4_A02_B1_P08_R00.csv")
beta_mse_TrtNoSpill_3x4_A02_B1_P08_R00$Psi <- 0.8
beta_mse_TrtNoSpill_3x4_A02_B1_P08_R00$Rho <- 0.00
beta_mse_TrtNoSpill_3x4_A02_B1_P08_R00$TrtSpill <- "No"
beta_mse_TrtNoSpill_3x4_A02_B1_P08_R00$Sampling <- "Random"
beta_mse_TrtNoSpill_3x4_A02_B1_P08_R00_random <- beta_mse_TrtNoSpill_3x4_A02_B1_P08_R00 %>% select(-c(X, bias.abs))
beta_mse_TrtNoSpill_3x4_A02_B1_P08_R00_block <- beta_mse_TrtNoSpill_3x4_A02_B1_P08_R00_random[c(28,43),]
beta_mse_TrtNoSpill_3x4_A02_B1_P08_R00_block$Sampling <- "Block"

# psi = 0.8, rho = 0.01
beta_mse_TrtNoSpill_3x4_A02_B1_P08_R001 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtNoSpill_3x4_A02_B1_P08_R001.csv")
beta_mse_TrtNoSpill_3x4_A02_B1_P08_R001$Psi <- 0.8
beta_mse_TrtNoSpill_3x4_A02_B1_P08_R001$Rho <- 0.01
beta_mse_TrtNoSpill_3x4_A02_B1_P08_R001$TrtSpill <- "No"
beta_mse_TrtNoSpill_3x4_A02_B1_P08_R001$Sampling <- "Random"
beta_mse_TrtNoSpill_3x4_A02_B1_P08_R001_random <- beta_mse_TrtNoSpill_3x4_A02_B1_P08_R001 %>% select(-c(X, bias.abs))
beta_mse_TrtNoSpill_3x4_A02_B1_P08_R001_block <- beta_mse_TrtNoSpill_3x4_A02_B1_P08_R001_random[c(28,43),]
beta_mse_TrtNoSpill_3x4_A02_B1_P08_R001_block$Sampling <- "Block"

## TrtSpill ##
# psi = 0.5, rho = 0.00
beta_mse_TrtSpill_3x4_A02_B1_P05_R00 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtSpill_3x4_A02_B1_P05_R00.csv")
beta_mse_TrtSpill_3x4_A02_B1_P05_R00$Psi <- 0.5
beta_mse_TrtSpill_3x4_A02_B1_P05_R00$Rho <- 0.00
beta_mse_TrtSpill_3x4_A02_B1_P05_R00$TrtSpill <- "Yes"
beta_mse_TrtSpill_3x4_A02_B1_P05_R00$Sampling <- "Random"
beta_mse_TrtSpill_3x4_A02_B1_P05_R00_random <- beta_mse_TrtSpill_3x4_A02_B1_P05_R00 %>% select(-c(X, bias.abs))
beta_mse_TrtSpill_3x4_A02_B1_P05_R00_block <- beta_mse_TrtSpill_3x4_A02_B1_P05_R00_random[c(28,43),]
beta_mse_TrtSpill_3x4_A02_B1_P05_R00_block$Sampling <- "Block"

# psi = 0.5, rho = 0.01
beta_mse_TrtSpill_3x4_A02_B1_P05_R001 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtSpill_3x4_A02_B1_P05_R001.csv")
beta_mse_TrtSpill_3x4_A02_B1_P05_R001$Psi <- 0.5
beta_mse_TrtSpill_3x4_A02_B1_P05_R001$Rho <- 0.01
beta_mse_TrtSpill_3x4_A02_B1_P05_R001$TrtSpill <- "Yes"
beta_mse_TrtSpill_3x4_A02_B1_P05_R001$Sampling <- "Random"
beta_mse_TrtSpill_3x4_A02_B1_P05_R001_random <- beta_mse_TrtSpill_3x4_A02_B1_P05_R001 %>% select(-c(X, bias.abs))
beta_mse_TrtSpill_3x4_A02_B1_P05_R001_block <- beta_mse_TrtSpill_3x4_A02_B1_P05_R001_random[c(28,43),]
beta_mse_TrtSpill_3x4_A02_B1_P05_R001_block$Sampling <- "Block"

# psi = 0.6, rho = 0.00
beta_mse_TrtSpill_3x4_A02_B1_P06_R00 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtSpill_3x4_A02_B1_P06_R00.csv")
beta_mse_TrtSpill_3x4_A02_B1_P06_R00$Psi <- 0.6
beta_mse_TrtSpill_3x4_A02_B1_P06_R00$Rho <- 0.00
beta_mse_TrtSpill_3x4_A02_B1_P06_R00$TrtSpill <- "Yes"
beta_mse_TrtSpill_3x4_A02_B1_P06_R00$Sampling <- "Random"
beta_mse_TrtSpill_3x4_A02_B1_P06_R00_random <- beta_mse_TrtSpill_3x4_A02_B1_P06_R00 %>% select(-c(X, bias.abs))
beta_mse_TrtSpill_3x4_A02_B1_P06_R00_block <- beta_mse_TrtSpill_3x4_A02_B1_P06_R00_random[c(28,43),]
beta_mse_TrtSpill_3x4_A02_B1_P06_R00_block$Sampling <- "Block"

# psi = 0.6, rho = 0.01
beta_mse_TrtSpill_3x4_A02_B1_P06_R001 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtSpill_3x4_A02_B1_P06_R001.csv")
beta_mse_TrtSpill_3x4_A02_B1_P06_R001$Psi <- 0.6
beta_mse_TrtSpill_3x4_A02_B1_P06_R001$Rho <- 0.01
beta_mse_TrtSpill_3x4_A02_B1_P06_R001$TrtSpill <- "Yes"
beta_mse_TrtSpill_3x4_A02_B1_P06_R001$Sampling <- "Random"
beta_mse_TrtSpill_3x4_A02_B1_P06_R001_random <- beta_mse_TrtSpill_3x4_A02_B1_P06_R001 %>% select(-c(X, bias.abs))
beta_mse_TrtSpill_3x4_A02_B1_P06_R001_block <- beta_mse_TrtSpill_3x4_A02_B1_P06_R001_random[c(28,43),]
beta_mse_TrtSpill_3x4_A02_B1_P06_R001_block$Sampling <- "Block"

# psi = 0.7, rho = 0.00
beta_mse_TrtSpill_3x4_A02_B1_P07_R00 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtSpill_3x4_A02_B1_P07_R00.csv")
beta_mse_TrtSpill_3x4_A02_B1_P07_R00$Psi <- 0.7
beta_mse_TrtSpill_3x4_A02_B1_P07_R00$Rho <- 0.00
beta_mse_TrtSpill_3x4_A02_B1_P07_R00$TrtSpill <- "Yes"
beta_mse_TrtSpill_3x4_A02_B1_P07_R00$Sampling <- "Random"
beta_mse_TrtSpill_3x4_A02_B1_P07_R00_random <- beta_mse_TrtSpill_3x4_A02_B1_P07_R00 %>% select(-c(X, bias.abs))
beta_mse_TrtSpill_3x4_A02_B1_P07_R00_block <- beta_mse_TrtSpill_3x4_A02_B1_P07_R00_random[c(28,43),]
beta_mse_TrtSpill_3x4_A02_B1_P07_R00_block$Sampling <- "Block"

# psi = 0.7, rho = 0.01
beta_mse_TrtSpill_3x4_A02_B1_P07_R001 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtSpill_3x4_A02_B1_P07_R001.csv")
beta_mse_TrtSpill_3x4_A02_B1_P07_R001$Psi <- 0.7
beta_mse_TrtSpill_3x4_A02_B1_P07_R001$Rho <- 0.01
beta_mse_TrtSpill_3x4_A02_B1_P07_R001$TrtSpill <- "Yes"
beta_mse_TrtSpill_3x4_A02_B1_P07_R001$Sampling <- "Random"
beta_mse_TrtSpill_3x4_A02_B1_P07_R001_random <- beta_mse_TrtSpill_3x4_A02_B1_P07_R001 %>% select(-c(X, bias.abs))
beta_mse_TrtSpill_3x4_A02_B1_P07_R001_block <- beta_mse_TrtSpill_3x4_A02_B1_P07_R001_random[c(28,43),]
beta_mse_TrtSpill_3x4_A02_B1_P07_R001_block$Sampling <- "Block"

# psi = 0.8, rho = 0.00
beta_mse_TrtSpill_3x4_A02_B1_P08_R00 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtSpill_3x4_A02_B1_P08_R00.csv")
beta_mse_TrtSpill_3x4_A02_B1_P08_R00$Psi <- 0.8
beta_mse_TrtSpill_3x4_A02_B1_P08_R00$Rho <- 0.00
beta_mse_TrtSpill_3x4_A02_B1_P08_R00$TrtSpill <- "Yes"
beta_mse_TrtSpill_3x4_A02_B1_P08_R00$Sampling <- "Random"
beta_mse_TrtSpill_3x4_A02_B1_P08_R00_random <- beta_mse_TrtSpill_3x4_A02_B1_P08_R00 %>% select(-c(X, bias.abs))
beta_mse_TrtSpill_3x4_A02_B1_P08_R00_block <- beta_mse_TrtSpill_3x4_A02_B1_P08_R00_random[c(28,43),]
beta_mse_TrtSpill_3x4_A02_B1_P08_R00_block$Sampling <- "Block"

# psi = 0.8, rho = 0.01
beta_mse_TrtSpill_3x4_A02_B1_P08_R001 <- read.csv("~/GithubProjects/SpatialCRT/code/NCdocSpatialSim/beta_mse/beta_mse_results_TrtSpill_3x4_A02_B1_P08_R001.csv")
beta_mse_TrtSpill_3x4_A02_B1_P08_R001$Psi <- 0.8
beta_mse_TrtSpill_3x4_A02_B1_P08_R001$Rho <- 0.01
beta_mse_TrtSpill_3x4_A02_B1_P08_R001$TrtSpill <- "Yes"
beta_mse_TrtSpill_3x4_A02_B1_P08_R001$Sampling <- "Random"
beta_mse_TrtSpill_3x4_A02_B1_P08_R001_random <- beta_mse_TrtSpill_3x4_A02_B1_P08_R001 %>% select(-c(X, bias.abs))
beta_mse_TrtSpill_3x4_A02_B1_P08_R001_block <- beta_mse_TrtSpill_3x4_A02_B1_P08_R001_random[c(28,43),]
beta_mse_TrtSpill_3x4_A02_B1_P08_R001_block$Sampling <- "Block"
```

```{r}
# Bind dfs for plotting
## TrtNoSpill ##
beta_mse_TrtNoSpill_join <- bind_rows(
  beta_mse_TrtNoSpill_3x4_A02_B1_P05_R00_random, # psi = 0.5, rho = 0.00
  beta_mse_TrtNoSpill_3x4_A02_B1_P05_R00_block, # psi = 0.5, rho = 0.00
  beta_mse_TrtNoSpill_3x4_A02_B1_P05_R001_random, # psi = 0.5, rho = 0.01
  beta_mse_TrtNoSpill_3x4_A02_B1_P05_R001_block, # psi = 0.5, rho = 0.01
  beta_mse_TrtNoSpill_3x4_A02_B1_P06_R00_random, # psi = 0.6, rho = 0.00
  beta_mse_TrtNoSpill_3x4_A02_B1_P06_R00_block, # psi = 0.6, rho = 0.00
  beta_mse_TrtNoSpill_3x4_A02_B1_P06_R001_random, # psi = 0.6, rho = 0.01
  beta_mse_TrtNoSpill_3x4_A02_B1_P06_R001_block, # psi = 0.6, rho = 0.01
  beta_mse_TrtNoSpill_3x4_A02_B1_P07_R00_random, # psi = 0.7, rho = 0.00
  beta_mse_TrtNoSpill_3x4_A02_B1_P07_R00_block, # psi = 0.7, rho = 0.00
  beta_mse_TrtNoSpill_3x4_A02_B1_P07_R001_random, # psi = 0.7, rho = 0.01
  beta_mse_TrtNoSpill_3x4_A02_B1_P07_R001_block, # psi = 0.7, rho = 0.01
  beta_mse_TrtNoSpill_3x4_A02_B1_P08_R00_random, # psi = 0.8, rho = 0.00
  beta_mse_TrtNoSpill_3x4_A02_B1_P08_R00_block, # psi = 0.8, rho = 0.00
  beta_mse_TrtNoSpill_3x4_A02_B1_P08_R001_random, # psi = 0.8, rho = 0.01
  beta_mse_TrtNoSpill_3x4_A02_B1_P08_R001_block, # psi = 0.8, rho = 0.01
)

## TrtSpill ##
beta_mse_TrtSpill_join <- bind_rows(
  beta_mse_TrtSpill_3x4_A02_B1_P05_R00_random, # psi = 0.5, rho = 0.00
  beta_mse_TrtSpill_3x4_A02_B1_P05_R00_block, # psi = 0.5, rho = 0.00
  beta_mse_TrtSpill_3x4_A02_B1_P05_R001_random, # psi = 0.5, rho = 0.01
  beta_mse_TrtSpill_3x4_A02_B1_P05_R001_block, # psi = 0.5, rho = 0.01
  beta_mse_TrtSpill_3x4_A02_B1_P06_R00_random, # psi = 0.6, rho = 0.00
  beta_mse_TrtSpill_3x4_A02_B1_P06_R00_block, # psi = 0.6, rho = 0.00
  beta_mse_TrtSpill_3x4_A02_B1_P06_R001_random, # psi = 0.6, rho = 0.01
  beta_mse_TrtSpill_3x4_A02_B1_P06_R001_block, # psi = 0.6, rho = 0.01
  beta_mse_TrtSpill_3x4_A02_B1_P07_R00_random, # psi = 0.7, rho = 0.00
  beta_mse_TrtSpill_3x4_A02_B1_P07_R00_block, # psi = 0.7, rho = 0.00
  beta_mse_TrtSpill_3x4_A02_B1_P07_R001_random, # psi = 0.7, rho = 0.01
  beta_mse_TrtSpill_3x4_A02_B1_P07_R001_block, # psi = 0.7, rho = 0.01
  beta_mse_TrtSpill_3x4_A02_B1_P08_R00_random, # psi = 0.8, rho = 0.00
  beta_mse_TrtSpill_3x4_A02_B1_P08_R00_block, # psi = 0.8, rho = 0.00
  beta_mse_TrtSpill_3x4_A02_B1_P08_R001_random, # psi = 0.8, rho = 0.01
  beta_mse_TrtSpill_3x4_A02_B1_P08_R001_block, # psi = 0.8, rho = 0.01
)
```

```{r}
### Boxplot for 3x4 TrtNoSpill ###
# Prepare the data
df_plot <- beta_mse_TrtNoSpill_join %>%
  mutate(
    Psi = as.factor(Psi),
    Rho = sprintf("%.2f", as.numeric(Rho)),
    Group = paste0("Rho=", Rho, ", ", Sampling)
  )
print(df_plot) # print estimates

# Plot with Psi as fill/group inside each Group
ggplot(df_plot, aes(x = Group, y = MSE, fill = Psi)) +
  geom_boxplot(outlier.alpha = 0.3, position = position_dodge(width = 0.75)) +
  theme_minimal(base_size = 14) +
  labs(
    title = "Beta MSE Estimates (3x4) by Psi, Rho, Sampling Group",
    x = "Condition (TrtNoSpill)",
    y = "Mean Squared Error (MSE)",
    fill = expression(Psi)
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
####################################################################################################
### Boxplot for 3x4 TrtSpill ###
# Prepare the data
df_plot <- beta_mse_TrtSpill_join %>%
  mutate(
    Psi = as.factor(Psi),
    Rho = sprintf("%.2f", as.numeric(Rho)),
    Group = paste0("Rho=", Rho, ", ", Sampling)
  )
print(df_plot) # print estimates

# Plot with Psi as fill/group inside each Group
ggplot(df_plot, aes(x = Group, y = MSE, fill = Psi)) +
  geom_boxplot(outlier.alpha = 0.3, position = position_dodge(width = 0.75)) +
  theme_minimal(base_size = 14) +
  labs(
    title = "Beta MSE Estimates (3x4) by Psi, Rho, Sampling Group",
    x = "Condition (TrtSpill)",
    y = "Mean Squared Error (MSE)",
    fill = expression(Psi)
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

```{r}
# Boxplots: TrtNoSpill
plot1 <- ggplot(beta_mse_TrtNoSpill_join, aes(x = Sampling, y = MSE, fill = as.factor(Psi))) +
  geom_boxplot(outlier.alpha = 0.3, position = position_dodge(width = 0.75)) +
  theme_minimal(base_size = 14) +
  labs(
    title = "Beta MSE Estimates (3x4) by Psi, Rho, Sampling Group",
    x = "Condition (TrtNoSpill)",
    y = "Mean Squared Error (MSE)",
    fill = expression(Psi)
  ) +
  facet_wrap(~ Rho, labeller = label_bquote(Rho == .(Rho)), scales = "free_y") + # remove scales = "free_y" to fix y-axis
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
print(plot1)

# Boxplots: TrtSpill
plot2 <- ggplot(beta_mse_TrtSpill_join, aes(x = Sampling, y = MSE, fill = as.factor(Psi))) +
  geom_boxplot(outlier.alpha = 0.3, position = position_dodge(width = 0.75)) +
  theme_minimal(base_size = 14) +
  labs(
    title = "Beta MSE Estimates (3x4) by Psi, Rho, Sampling Group",
    x = "Condition (TrtSpill)",
    y = "Mean Squared Error (MSE)",
    fill = expression(Psi)
  ) +
  facet_wrap(~ Rho, labeller = label_bquote(Rho == .(Rho)), scales = "free_y") + # remove scales = "free_y" to fix y-axis
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
print(plot2)
# --- Join Plots together ---
plot1 / plot2
```

```{r}
# --- Create 2x2 plot for 3x4 grid ---
# Combine the two data frames
combined_df <- bind_rows(beta_mse_TrtNoSpill_join, beta_mse_TrtSpill_join)

# Create a new data frame with the modified labels
combined_df_relabeled <- combined_df %>%
  mutate(TrtSpill = recode(TrtSpill,
                           "Yes" = "Intervention & Control",
                           "No" = "Control Only"))

# Generate the faceted plot from the combined data
ggplot(combined_df_relabeled, aes(x = Sampling, y = MSE, fill = as.factor(Psi))) +
  geom_boxplot(outlier.alpha = 0.3, position = position_dodge(width = 0.75)) +
  theme_minimal(base_size = 14) +
  labs(
    # title = "Beta MSE Estimates by Scenario",
    # subtitle = expression(paste("Faceted by Treatment Spillover Type and ", Rho)),
    x = "Sampling Group",
    y = "Mean Squared Error (MSE)",
    fill = expression(Psi)
  ) +
  # Use facet_grid to create a grid: rows ~ columns
  facet_grid(TrtSpill ~ Rho, scales = "free_y", labeller = label_bquote(rows = .(TrtSpill), cols = rho == .(Rho))) +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 10),
    strip.text.y = element_text(size = 8, angle = 90),
    axis.title.y = element_text(size = 10), # Adjusts the y-axis title size
    axis.title.x = element_text(size = 10), # Adjusts the x-axis title size
    # Add a border around each facet panel
    #panel.border = element_rect(color = "black", fill = NA, linewidth = 0.5)
  )
```


```{r}
### Point + 95% CI for 3x4 TrtNoSpill ###
# Step 1: Summarize the data
df_summary <- beta_mse_TrtNoSpill_join %>%
  mutate(
    Psi = as.factor(Psi),
    Rho = sprintf("%.2f", as.numeric(Rho)),
    Group = paste0("Rho=", Rho, ", ", Sampling)
  ) %>%
  group_by(Group, Psi) %>%
  summarise(
    mean_MSE = mean(MSE),
    sd_MSE = sd(MSE),
    se = sd(MSE) / sqrt(n()),
    mean_bias = mean(bias),
    .groups = "drop"
  ) %>%
  mutate(
    lower = mean_MSE - 1.96 * se,
    upper = mean_MSE + 1.96 * se
  )
print(df_summary) # print estimates

# Step 2: Plot
ggplot(df_summary, aes(x = Group, y = mean_MSE, color = Psi, group = Psi)) +
  geom_point(position = position_dodge(width = 0.5), size = 3) +
  geom_errorbar(aes(ymin = lower, ymax = upper),
                position = position_dodge(width = 0.5),
                width = 0.2) +
  theme_minimal(base_size = 14) +
  labs(
    title = "Beta MSE Estimates w/CI (3x4) by Psi, Rho, Sampling Group",
    x = "Condition (TrtNoSpill)",
    y = "Mean Squared Error (MSE)",
    color = expression(Psi)
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
####################################################################################################
### Point + 95% CI for 3x4 TrtSpill ###
# Step 1: Summarize the data
df_summary <- beta_mse_TrtSpill_join %>%
  mutate(
    Psi = as.factor(Psi),
    Rho = sprintf("%.2f", as.numeric(Rho)),
    Group = paste0("Rho=", Rho, ", ", Sampling)
  ) %>%
  group_by(Group, Psi) %>%
  summarise(
    mean_MSE = mean(MSE),
    sd_MSE = sd(MSE),
    se = sd(MSE) / sqrt(n()),
    mean_bias = mean(bias),
    .groups = "drop"
  ) %>%
  mutate(
    lower = mean_MSE - 1.96 * se,
    upper = mean_MSE + 1.96 * se
  )
print(df_summary) # print estimates

# Step 2: Plot
ggplot(df_summary, aes(x = Group, y = mean_MSE, color = Psi, group = Psi)) +
  geom_point(position = position_dodge(width = 0.5), size = 3) +
  geom_errorbar(aes(ymin = lower, ymax = upper),
                position = position_dodge(width = 0.5),
                width = 0.2) +
  theme_minimal(base_size = 14) +
  labs(
    title = "Beta MSE Estimates w/CI (3x4) by Psi, Rho, Sampling Group",
    x = "Condition (TrtSpill)",
    y = "Mean Squared Error (MSE)",
    color = expression(Psi)
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```
